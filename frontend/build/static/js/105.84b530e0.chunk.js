"use strict";(self.webpackChunkbedrock_diy_frontend=self.webpackChunkbedrock_diy_frontend||[]).push([[105],{1105:(e,r,t)=>{t.d(r,{fetchAuthSession:()=>M.$,signOut:()=>P.C});var n=t(3413),o=t(4163),i=t(4492),s=t(2770),a=t(2600),c=t(9931),d=t(2311),u=t(727),l=t(2206);var f=t(8173),p=t(6998),g=t(155),h=t(851),m=t(1763),y=t(4619),w=t(2200);new y.C("AuthError");Error;const A={oauthSignInError:{message:w.fs.OAUTH_ERROR,log:"Make sure Cognito Hosted UI has been configured correctly"},noConfig:{message:w.fs.DEFAULT_MSG,log:"\n            Error: Amplify has not been configured correctly.\n            This error is typically caused by one of the following scenarios:\n\n            1. Make sure you're passing the awsconfig object to Amplify.configure() in your app's entry point\n                See https://aws-amplify.github.io/docs/js/authentication#configure-your-app for more information\n            \n            2. There might be multiple conflicting versions of amplify packages in your node_modules.\n\t\t\t\tRefer to our docs site for help upgrading Amplify packages (https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js)\n        "},missingAuthConfig:{message:w.fs.DEFAULT_MSG,log:"\n            Error: Amplify has not been configured correctly. \n            The configuration object is missing required auth properties.\n            This error is typically caused by one of the following scenarios:\n\n            1. Did you run `amplify push` after adding auth via `amplify add auth`?\n                See https://aws-amplify.github.io/docs/js/authentication#amplify-project-setup for more information\n\n            2. This could also be caused by multiple conflicting versions of amplify packages, see (https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js) for help upgrading Amplify packages.\n        "},emptyUsername:{message:w.fs.EMPTY_USERNAME},invalidUsername:{message:w.fs.INVALID_USERNAME},emptyPassword:{message:w.fs.EMPTY_PASSWORD},emptyCode:{message:w.fs.EMPTY_CODE},signUpError:{message:w.fs.SIGN_UP_ERROR,log:"The first parameter should either be non-null string or object"},noMFA:{message:w.fs.NO_MFA},invalidMFA:{message:w.fs.INVALID_MFA},emptyChallengeResponse:{message:w.fs.EMPTY_CHALLENGE},noUserSession:{message:w.fs.NO_USER_SESSION},deviceConfig:{message:w.fs.DEVICE_CONFIG},networkError:{message:w.fs.NETWORK_ERROR},autoSignInError:{message:w.fs.AUTOSIGNIN_ERROR},default:{message:w.fs.DEFAULT_MSG}};var S=t(2096);const E=(e,r)=>new S.l({message:e??"An error has occurred during the oauth process.",name:w.nC.OAuthSignInError,recoverySuggestion:r??A.oauthSignInError.log});var _;!function(e){e.NoConfig="noConfig",e.MissingAuthConfig="missingAuthConfig",e.EmptyUsername="emptyUsername",e.InvalidUsername="invalidUsername",e.EmptyPassword="emptyPassword",e.EmptyCode="emptyCode",e.SignUpError="signUpError",e.NoMFA="noMFA",e.InvalidMFA="invalidMFA",e.EmptyChallengeResponse="emptyChallengeResponse",e.NoUserSession="noUserSession",e.Default="default",e.DeviceConfig="deviceConfig",e.NetworkError="networkError",e.AutoSignInError="autoSignInError",e.OAuthSignInError="oauthSignInError"}(_||(_={}));const v=async e=>{const r=await d.f.loadOAuthState(),t=e===r?r:void 0;if(!t)throw new S.l({name:_.OAuthSignInError,message:null===e?"`signInWithRedirect` has been canceled.":"An error occurred while validating the state.",recoverySuggestion:null===e?void 0:"Try to initiate an OAuth flow from Amplify"});return t},U=async e=>{let{currentUrl:r,userAgentValue:t,clientId:n,redirectUri:o,domain:i,preferPrivateSession:a}=e;const c=new u.o(r),f=c.searchParams.get("code"),g=c.searchParams.get("state");if(!f||!g)throw E("User cancelled OAuth flow.");const h=await v(g),m="https://"+i+"/oauth2/token",y=await d.f.loadPKCE(),w={grant_type:"authorization_code",code:f,client_id:n,redirect_uri:o,...y?{code_verifier:y}:{}},A=Object.entries(w).map(e=>{let[r,t]=e;return`${encodeURIComponent(r)}=${encodeURIComponent(t)}`}).join("&"),{access_token:S,refresh_token:_,id_token:U,error:I,error_message:k,token_type:O,expires_in:R}=await(await fetch(m,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",[l.YJ]:t},body:A})).json();if(I)throw E(k??I);const T=(S&&(0,s.Cq)(S).payload.username)??"username";return await(0,p.i)({username:T,AccessToken:S,IdToken:U,RefreshToken:_}),C({redirectUri:o,state:h,preferPrivateSession:a})},I=async e=>{let{currentUrl:r,redirectUri:t,preferPrivateSession:n}=e;const o=new u.o(r),{id_token:i,access_token:a,state:c,token_type:d,expires_in:l,error_description:f,error:g}=(o.hash??"#").substring(1).split("&").map(e=>e.split("=")).reduce((e,r)=>{let[t,n]=r;return{...e,[t]:n}},{id_token:void 0,access_token:void 0,state:void 0,token_type:void 0,expires_in:void 0,error_description:void 0,error:void 0});if(g)throw E(f??g);if(!a)throw E("No access token returned from OAuth flow.");const h=await v(c),m=(a&&(0,s.Cq)(a).payload.username)??"username";return await(0,p.i)({username:m,AccessToken:a,IdToken:i}),C({redirectUri:t,state:h,preferPrivateSession:n})},C=async e=>{let{redirectUri:r,state:t,preferPrivateSession:n}=e;var o;await m.o.setOAuthMetadata({oauthSignIn:!0}),await d.f.clearOAuthData(),await d.f.storeOAuthSignIn(!0,n),(0,h.i)(),R(r),k(t)&&f.YZ.dispatch("auth",{event:"customOAuthState",data:(o=O(t),(o.match(/.{2}/g)||[]).map(e=>String.fromCharCode(parseInt(e,16))).join(""))},"Auth",f.U9),f.YZ.dispatch("auth",{event:"signInWithRedirect"},"Auth",f.U9),await(0,g.Q)()},k=e=>/-/.test(e),O=e=>e.split("-").splice(1).join("-"),R=e=>{"undefined"!==typeof window&&"undefined"!==typeof window.history&&window.history.replaceState(window.history.state,"",e)};var T=t(4872);const b=async e=>{try{(0,s.$y)(e),(0,s.G6)(e),d.f.setAuthConfig(e)}catch(r){return}if(await d.f.loadOAuthInFlight())try{const r=window.location.href,{loginWith:t,userPoolClientId:n}=e,{domain:o,redirectSignIn:i,responseType:s}=t.oauth,d=(0,T.M)(i);await(async e=>{let{currentUrl:r,userAgentValue:t,clientId:n,redirectUri:o,responseType:i,domain:s,preferPrivateSession:a}=e;const c=new u.o(r),d=c.searchParams.get("error"),l=c.searchParams.get("error_description");if(d)throw E(l??d);return"code"===i?U({currentUrl:r,userAgentValue:t,clientId:n,redirectUri:o,domain:s,preferPrivateSession:a}):I({currentUrl:r,redirectUri:o,preferPrivateSession:a})})({currentUrl:r,clientId:n,domain:o,redirectUri:d,responseType:s,userAgentValue:(0,c.A)(a.BM.SignInWithRedirect)})}catch(t){await(async e=>{(0,h.i)(),await d.f.clearOAuthInflightData(),f.YZ.dispatch("auth",{event:"signInWithRedirect_failure",data:{error:e}},"Auth",f.U9)})(t)}};(0,o.B)()&&n.H[i.$](b);var P=t(9848),M=t(7648);t(4228)}}]);
//# sourceMappingURL=105.84b530e0.chunk.js.map