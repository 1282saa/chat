{"ast":null,"code":"import{useState,useEffect,useRef,useCallback}from\"react\";/**\n * WebSocket 실시간 스트리밍을 위한 커스텀 훅\n */export const useWebSocket=projectId=>{const[isConnected,setIsConnected]=useState(false);const[isConnecting,setIsConnecting]=useState(false);const[error,setError]=useState(null);const wsRef=useRef(null);const reconnectTimeoutRef=useRef(null);const reconnectAttempts=useRef(0);const maxReconnectAttempts=5;// WebSocket URL (환경변수나 실제 배포된 URL로 설정)\nconst getWebSocketUrl=useCallback(async()=>{const wsUrl=process.env.REACT_APP_WS_URL||\"wss://your-websocket-api.execute-api.us-east-1.amazonaws.com/prod\";// URL 형식 검증 및 정규화\nif(!wsUrl.startsWith(\"wss://\")&&!wsUrl.startsWith(\"ws://\")){console.error(\"잘못된 WebSocket URL 형식:\",wsUrl);return null;}// 끝에 슬래시 제거\nlet normalizedUrl=wsUrl.replace(/\\/$/,\"\");// 인증 토큰을 쿼리 파라미터로 추가\ntry{var _session$tokens,_session$tokens$idTok;const{fetchAuthSession}=await import('aws-amplify/auth');const session=await fetchAuthSession();const token=session===null||session===void 0?void 0:(_session$tokens=session.tokens)===null||_session$tokens===void 0?void 0:(_session$tokens$idTok=_session$tokens.idToken)===null||_session$tokens$idTok===void 0?void 0:_session$tokens$idTok.toString();if(token){// URL에 토큰을 쿼리 파라미터로 추가\nnormalizedUrl+=`?token=${encodeURIComponent(token)}`;console.log(\"✅ WebSocket URL에 인증 토큰 추가됨\");}else{console.log(\"⚠️ 인증 토큰이 없음 - 공개 WebSocket 연결 시도\");}}catch(authError){console.log(\"📝 인증 토큰 가져오기 실패:\",authError.message);}console.log(\"WebSocket URL 확인:\",normalizedUrl.replace(/token=[^&]+/,'token=***'));console.log(\"환경변수 REACT_APP_WS_URL:\",process.env.REACT_APP_WS_URL);return normalizedUrl;},[]);// WebSocket 연결\nconst connect=useCallback(async()=>{var _wsRef$current,_wsRef$current2;// 이미 연결 중이거나 연결된 경우 중복 연결 방지\nif(((_wsRef$current=wsRef.current)===null||_wsRef$current===void 0?void 0:_wsRef$current.readyState)===WebSocket.OPEN||((_wsRef$current2=wsRef.current)===null||_wsRef$current2===void 0?void 0:_wsRef$current2.readyState)===WebSocket.CONNECTING){console.log(\"이미 연결된 WebSocket이 있습니다 (readyState:\",wsRef.current.readyState,\")\");return;}// 이전 연결이 있다면 정리\nif(wsRef.current){wsRef.current.close();wsRef.current=null;}setIsConnecting(true);setError(null);try{const wsUrl=await getWebSocketUrl();if(!wsUrl){setError(\"유효하지 않은 WebSocket URL\");setIsConnecting(false);return;}console.log(\"WebSocket 연결 시도:\",wsUrl);console.log(\"브라우저 WebSocket 지원:\",!!window.WebSocket);// 연결 시도 시간 기록\nwindow.wsConnectStart=Date.now();wsRef.current=new WebSocket(wsUrl);// 연결 상태 모니터링\nconst connectionTimeout=setTimeout(()=>{var _wsRef$current3;if(((_wsRef$current3=wsRef.current)===null||_wsRef$current3===void 0?void 0:_wsRef$current3.readyState)===WebSocket.CONNECTING){console.error(\"WebSocket 연결 시간 초과\");wsRef.current.close();setError(\"연결 시간이 초과되었습니다\");setIsConnecting(false);}},10000);// 10초 타임아웃\nwsRef.current.onopen=event=>{var _wsRef$current4,_wsRef$current5,_wsRef$current6;clearTimeout(connectionTimeout);console.log(\"🟢 WebSocket 연결 성공!\");console.log(\"- Event:\",event);console.log(\"- URL:\",(_wsRef$current4=wsRef.current)===null||_wsRef$current4===void 0?void 0:_wsRef$current4.url);console.log(\"- Protocol:\",(_wsRef$current5=wsRef.current)===null||_wsRef$current5===void 0?void 0:_wsRef$current5.protocol);console.log(\"- Extensions:\",(_wsRef$current6=wsRef.current)===null||_wsRef$current6===void 0?void 0:_wsRef$current6.extensions);setIsConnected(true);setIsConnecting(false);setError(null);reconnectAttempts.current=0;};wsRef.current.onclose=event=>{clearTimeout(connectionTimeout);const connectionDuration=Date.now()-(window.wsConnectStart||0);console.log(\"🔴 WebSocket 연결 종료:\");console.log(\"- Code:\",event.code);console.log(\"- Reason:\",event.reason||\"(no reason provided)\");console.log(\"- WasClean:\",event.wasClean);console.log(\"- Connection duration:\",connectionDuration+\"ms\");setIsConnected(false);setIsConnecting(false);// 즉시 종료된 경우 (500ms 이내) - 서버 문제\nif(connectionDuration<500){console.error(\"⚠️ WebSocket이 즉시 종료됨 - 서버 문제 가능성\");// 특정 에러 코드에 따른 세분화된 에러 메시지\nlet errorMessage=\"서버 연결에 실패했습니다.\";switch(event.code){case 1006:errorMessage=\"비정상적인 연결 종료 (네트워크 문제 가능성)\";break;case 1002:errorMessage=\"프로토콜 오류\";break;case 1003:errorMessage=\"지원하지 않는 데이터 타입\";break;case 1011:errorMessage=\"서버 내부 오류\";break;case 1001:errorMessage=\"서버가 종료되었습니다\";break;case 1012:errorMessage=\"서버 재시작 중입니다\";break;case 1013:errorMessage=\"나중에 다시 시도해주세요\";break;case 1014:errorMessage=\"잘못된 게이트웨이\";break;case 1015:errorMessage=\"TLS 연결 실패\";break;}setError(errorMessage);return;}// 자동 재연결 (정상 종료가 아닌 경우)\nif(event.code!==1000&&reconnectAttempts.current<maxReconnectAttempts){const delay=Math.min(1000*Math.pow(2,reconnectAttempts.current),30000);console.log(`🔄 ${delay}ms 후 재연결 시도 (${reconnectAttempts.current+1}/${maxReconnectAttempts})`);reconnectTimeoutRef.current=setTimeout(()=>{reconnectAttempts.current++;connect();},delay);}else if(reconnectAttempts.current>=maxReconnectAttempts){setError(\"최대 재연결 시도 횟수에 도달했습니다.\");}};wsRef.current.onerror=error=>{var _wsRef$current7,_wsRef$current8;clearTimeout(connectionTimeout);console.error(\"💥 WebSocket 오류:\",error);console.log(\"- ReadyState:\",(_wsRef$current7=wsRef.current)===null||_wsRef$current7===void 0?void 0:_wsRef$current7.readyState);console.log(\"- URL:\",(_wsRef$current8=wsRef.current)===null||_wsRef$current8===void 0?void 0:_wsRef$current8.url);setError(\"WebSocket 연결 오류가 발생했습니다\");setIsConnecting(false);};}catch(err){console.error(\"💥 WebSocket 생성 실패:\",err);setError(\"WebSocket 연결에 실패했습니다: \"+err.message);setIsConnecting(false);}},[getWebSocketUrl]);// WebSocket 연결 해제\nconst disconnect=useCallback(()=>{if(reconnectTimeoutRef.current){clearTimeout(reconnectTimeoutRef.current);reconnectTimeoutRef.current=null;}if(wsRef.current){wsRef.current.close(1000,\"Manual disconnect\");wsRef.current=null;}setIsConnected(false);setIsConnecting(false);reconnectAttempts.current=0;},[]);// 메시지 전송\nconst sendMessage=useCallback(message=>{var _wsRef$current9;if(((_wsRef$current9=wsRef.current)===null||_wsRef$current9===void 0?void 0:_wsRef$current9.readyState)===WebSocket.OPEN){wsRef.current.send(JSON.stringify(message));return true;}else{console.error(\"WebSocket이 연결되지 않았습니다\");setError(\"WebSocket 연결이 필요합니다\");return false;}},[]);// 스트리밍 요청\nconst startStreaming=useCallback(function(userInput){let chatHistory=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let promptCards=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let modelId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;let conversationId=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;let userSub=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;if(!isConnected){setError(\"WebSocket 연결이 필요합니다\");return false;}const message={action:\"stream\",projectId,userInput,chat_history:chatHistory,prompt_cards:promptCards,modelId:modelId,conversationId:conversationId,userSub:userSub};console.log('WebSocket 메시지 전송:',{action:message.action,projectId:message.projectId,inputLength:userInput.length,historyLength:chatHistory.length,promptCardsCount:promptCards.length,conversationId:message.conversationId,userSub:message.userSub});return sendMessage(message);},[isConnected,projectId,sendMessage]);// 메시지 리스너 등록\nconst addMessageListener=useCallback(listener=>{if(wsRef.current){wsRef.current.addEventListener(\"message\",listener);}},[]);// 메시지 리스너 제거\nconst removeMessageListener=useCallback(listener=>{if(wsRef.current){wsRef.current.removeEventListener(\"message\",listener);}},[]);// 컴포넌트 마운트 시 연결, 언마운트 시 해제\nuseEffect(()=>{// 초기 연결 지연을 통해 React strict mode 이슈 회피\nconst timer=setTimeout(()=>{connect();},100);return()=>{clearTimeout(timer);disconnect();};},[]);// 의존성 배열을 빈 배열로 변경\n// projectId 변경 시 재연결 (이전 값과 비교하여 실제 변경시에만)\nconst prevProjectIdRef=useRef(projectId);useEffect(()=>{if(prevProjectIdRef.current!==projectId&&isConnected&&projectId){console.log('ProjectId 변경됨, 재연결 중:',prevProjectIdRef.current,'->',projectId);disconnect();setTimeout(connect,200);}prevProjectIdRef.current=projectId;},[projectId,isConnected]);// connect, disconnect 의존성 제거\nreturn{isConnected,isConnecting,error,connect,disconnect,sendMessage,startStreaming,addMessageListener,removeMessageListener};};","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","useWebSocket","projectId","isConnected","setIsConnected","isConnecting","setIsConnecting","error","setError","wsRef","reconnectTimeoutRef","reconnectAttempts","maxReconnectAttempts","getWebSocketUrl","wsUrl","process","env","REACT_APP_WS_URL","startsWith","console","normalizedUrl","replace","_session$tokens","_session$tokens$idTok","fetchAuthSession","session","token","tokens","idToken","toString","encodeURIComponent","log","authError","message","connect","_wsRef$current","_wsRef$current2","current","readyState","WebSocket","OPEN","CONNECTING","close","window","wsConnectStart","Date","now","connectionTimeout","setTimeout","_wsRef$current3","onopen","event","_wsRef$current4","_wsRef$current5","_wsRef$current6","clearTimeout","url","protocol","extensions","onclose","connectionDuration","code","reason","wasClean","errorMessage","delay","Math","min","pow","onerror","_wsRef$current7","_wsRef$current8","err","disconnect","sendMessage","_wsRef$current9","send","JSON","stringify","startStreaming","userInput","chatHistory","arguments","length","undefined","promptCards","modelId","conversationId","userSub","action","chat_history","prompt_cards","inputLength","historyLength","promptCardsCount","addMessageListener","listener","addEventListener","removeMessageListener","removeEventListener","timer","prevProjectIdRef"],"sources":["/Users/yeong-gwang/Documents/work/서울경제신문/dev/nexus/title_generator_ver1/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from \"react\";\n\n/**\n * WebSocket 실시간 스트리밍을 위한 커스텀 훅\n */\nexport const useWebSocket = (projectId) => {\n  const [isConnected, setIsConnected] = useState(false);\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState(null);\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // WebSocket URL (환경변수나 실제 배포된 URL로 설정)\n  const getWebSocketUrl = useCallback(async () => {\n    const wsUrl =\n      process.env.REACT_APP_WS_URL ||\n      \"wss://your-websocket-api.execute-api.us-east-1.amazonaws.com/prod\";\n    \n    // URL 형식 검증 및 정규화\n    if (!wsUrl.startsWith(\"wss://\") && !wsUrl.startsWith(\"ws://\")) {\n      console.error(\"잘못된 WebSocket URL 형식:\", wsUrl);\n      return null;\n    }\n    \n    // 끝에 슬래시 제거\n    let normalizedUrl = wsUrl.replace(/\\/$/, \"\");\n    \n    // 인증 토큰을 쿼리 파라미터로 추가\n    try {\n      const { fetchAuthSession } = await import('aws-amplify/auth');\n      const session = await fetchAuthSession();\n      const token = session?.tokens?.idToken?.toString();\n      \n      if (token) {\n        // URL에 토큰을 쿼리 파라미터로 추가\n        normalizedUrl += `?token=${encodeURIComponent(token)}`;\n        console.log(\"✅ WebSocket URL에 인증 토큰 추가됨\");\n      } else {\n        console.log(\"⚠️ 인증 토큰이 없음 - 공개 WebSocket 연결 시도\");\n      }\n    } catch (authError) {\n      console.log(\"📝 인증 토큰 가져오기 실패:\", authError.message);\n    }\n    \n    console.log(\"WebSocket URL 확인:\", normalizedUrl.replace(/token=[^&]+/, 'token=***'));\n    console.log(\"환경변수 REACT_APP_WS_URL:\", process.env.REACT_APP_WS_URL);\n    \n    return normalizedUrl;\n  }, []);\n\n  // WebSocket 연결\n  const connect = useCallback(async () => {\n    // 이미 연결 중이거나 연결된 경우 중복 연결 방지\n    if (wsRef.current?.readyState === WebSocket.OPEN || \n        wsRef.current?.readyState === WebSocket.CONNECTING) {\n      console.log(\"이미 연결된 WebSocket이 있습니다 (readyState:\", wsRef.current.readyState, \")\");\n      return;\n    }\n\n    // 이전 연결이 있다면 정리\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n\n    setIsConnecting(true);\n    setError(null);\n\n    try {\n      const wsUrl = await getWebSocketUrl();\n      \n      if (!wsUrl) {\n        setError(\"유효하지 않은 WebSocket URL\");\n        setIsConnecting(false);\n        return;\n      }\n\n      console.log(\"WebSocket 연결 시도:\", wsUrl);\n      console.log(\"브라우저 WebSocket 지원:\", !!window.WebSocket);\n\n      // 연결 시도 시간 기록\n      window.wsConnectStart = Date.now();\n\n      wsRef.current = new WebSocket(wsUrl);\n\n      // 연결 상태 모니터링\n      const connectionTimeout = setTimeout(() => {\n        if (wsRef.current?.readyState === WebSocket.CONNECTING) {\n          console.error(\"WebSocket 연결 시간 초과\");\n          wsRef.current.close();\n          setError(\"연결 시간이 초과되었습니다\");\n          setIsConnecting(false);\n        }\n      }, 10000); // 10초 타임아웃\n\n      wsRef.current.onopen = (event) => {\n        clearTimeout(connectionTimeout);\n        console.log(\"🟢 WebSocket 연결 성공!\");\n        console.log(\"- Event:\", event);\n        console.log(\"- URL:\", wsRef.current?.url);\n        console.log(\"- Protocol:\", wsRef.current?.protocol);\n        console.log(\"- Extensions:\", wsRef.current?.extensions);\n        setIsConnected(true);\n        setIsConnecting(false);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n\n      wsRef.current.onclose = (event) => {\n        clearTimeout(connectionTimeout);\n        const connectionDuration = Date.now() - (window.wsConnectStart || 0);\n        \n        console.log(\"🔴 WebSocket 연결 종료:\");\n        console.log(\"- Code:\", event.code);\n        console.log(\"- Reason:\", event.reason || \"(no reason provided)\");\n        console.log(\"- WasClean:\", event.wasClean);\n        console.log(\"- Connection duration:\", connectionDuration + \"ms\");\n        \n        setIsConnected(false);\n        setIsConnecting(false);\n\n        // 즉시 종료된 경우 (500ms 이내) - 서버 문제\n        if (connectionDuration < 500) {\n          console.error(\"⚠️ WebSocket이 즉시 종료됨 - 서버 문제 가능성\");\n          \n          // 특정 에러 코드에 따른 세분화된 에러 메시지\n          let errorMessage = \"서버 연결에 실패했습니다.\";\n          switch(event.code) {\n            case 1006:\n              errorMessage = \"비정상적인 연결 종료 (네트워크 문제 가능성)\";\n              break;\n            case 1002:\n              errorMessage = \"프로토콜 오류\";\n              break;\n            case 1003:\n              errorMessage = \"지원하지 않는 데이터 타입\";\n              break;\n            case 1011:\n              errorMessage = \"서버 내부 오류\";\n              break;\n            case 1001:\n              errorMessage = \"서버가 종료되었습니다\";\n              break;\n            case 1012:\n              errorMessage = \"서버 재시작 중입니다\";\n              break;\n            case 1013:\n              errorMessage = \"나중에 다시 시도해주세요\";\n              break;\n            case 1014:\n              errorMessage = \"잘못된 게이트웨이\";\n              break;\n            case 1015:\n              errorMessage = \"TLS 연결 실패\";\n              break;\n          }\n          \n          setError(errorMessage);\n          return;\n        }\n\n        // 자동 재연결 (정상 종료가 아닌 경우)\n        if (\n          event.code !== 1000 &&\n          reconnectAttempts.current < maxReconnectAttempts\n        ) {\n          const delay = Math.min(\n            1000 * Math.pow(2, reconnectAttempts.current),\n            30000\n          );\n          console.log(\n            `🔄 ${delay}ms 후 재연결 시도 (${\n              reconnectAttempts.current + 1\n            }/${maxReconnectAttempts})`\n          );\n\n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttempts.current++;\n            connect();\n          }, delay);\n        } else if (reconnectAttempts.current >= maxReconnectAttempts) {\n          setError(\"최대 재연결 시도 횟수에 도달했습니다.\");\n        }\n      };\n\n      wsRef.current.onerror = (error) => {\n        clearTimeout(connectionTimeout);\n        console.error(\"💥 WebSocket 오류:\", error);\n        console.log(\"- ReadyState:\", wsRef.current?.readyState);\n        console.log(\"- URL:\", wsRef.current?.url);\n        setError(\"WebSocket 연결 오류가 발생했습니다\");\n        setIsConnecting(false);\n      };\n\n    } catch (err) {\n      console.error(\"💥 WebSocket 생성 실패:\", err);\n      setError(\"WebSocket 연결에 실패했습니다: \" + err.message);\n      setIsConnecting(false);\n    }\n  }, [getWebSocketUrl]);\n\n  // WebSocket 연결 해제\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = null;\n    }\n\n    if (wsRef.current) {\n      wsRef.current.close(1000, \"Manual disconnect\");\n      wsRef.current = null;\n    }\n\n    setIsConnected(false);\n    setIsConnecting(false);\n    reconnectAttempts.current = 0;\n  }, []);\n\n  // 메시지 전송\n  const sendMessage = useCallback((message) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n      return true;\n    } else {\n      console.error(\"WebSocket이 연결되지 않았습니다\");\n      setError(\"WebSocket 연결이 필요합니다\");\n      return false;\n    }\n  }, []);\n\n  // 스트리밍 요청\n  const startStreaming = useCallback(\n    (userInput, chatHistory = [], promptCards = [], modelId = null, conversationId = null, userSub = null) => {\n      if (!isConnected) {\n        setError(\"WebSocket 연결이 필요합니다\");\n        return false;\n      }\n\n      const message = {\n        action: \"stream\",\n        projectId,\n        userInput,\n        chat_history: chatHistory,\n        prompt_cards: promptCards,\n        modelId: modelId,\n        conversationId: conversationId,\n        userSub: userSub,\n      };\n\n      console.log('WebSocket 메시지 전송:', {\n        action: message.action,\n        projectId: message.projectId,\n        inputLength: userInput.length,\n        historyLength: chatHistory.length,\n        promptCardsCount: promptCards.length,\n        conversationId: message.conversationId,\n        userSub: message.userSub\n      });\n\n      return sendMessage(message);\n    },\n    [isConnected, projectId, sendMessage]\n  );\n\n  // 메시지 리스너 등록\n  const addMessageListener = useCallback((listener) => {\n    if (wsRef.current) {\n      wsRef.current.addEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // 메시지 리스너 제거\n  const removeMessageListener = useCallback((listener) => {\n    if (wsRef.current) {\n      wsRef.current.removeEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // 컴포넌트 마운트 시 연결, 언마운트 시 해제\n  useEffect(() => {\n    // 초기 연결 지연을 통해 React strict mode 이슈 회피\n    const timer = setTimeout(() => {\n      connect();\n    }, 100);\n    \n    return () => {\n      clearTimeout(timer);\n      disconnect();\n    };\n  }, []); // 의존성 배열을 빈 배열로 변경\n\n  // projectId 변경 시 재연결 (이전 값과 비교하여 실제 변경시에만)\n  const prevProjectIdRef = useRef(projectId);\n  useEffect(() => {\n    if (prevProjectIdRef.current !== projectId && isConnected && projectId) {\n      console.log('ProjectId 변경됨, 재연결 중:', prevProjectIdRef.current, '->', projectId);\n      disconnect();\n      setTimeout(connect, 200);\n    }\n    prevProjectIdRef.current = projectId;\n  }, [projectId, isConnected]); // connect, disconnect 의존성 제거\n\n  return {\n    isConnected,\n    isConnecting,\n    error,\n    connect,\n    disconnect,\n    sendMessage,\n    startStreaming,\n    addMessageListener,\n    removeMessageListener,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}