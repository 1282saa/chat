{"ast":null,"code":"import axios from \"axios\";\n\n// API 기본 설정\nconst API_BASE_URL = process.env.REACT_APP_API_URL || \"https://nq5qrt16lb.execute-api.us-east-1.amazonaws.com/prod\";\n\n// Mock data for development\nconst mockUsageData = {\n  todayRequests: 127,\n  todayTokens: 45320,\n  monthlyLimit: 1000000,\n  monthlyUsed: 523400,\n  plan: {\n    name: 'Professional',\n    expiresAt: '2025-02-28',\n    features: ['월 100만 토큰', '우선 지원', 'API 액세스']\n  },\n  chartData: Array.from({\n    length: 30\n  }, (_, i) => ({\n    date: new Date(Date.now() - (29 - i) * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n    tokens: Math.floor(Math.random() * 30000) + 10000,\n    requests: Math.floor(Math.random() * 100) + 50\n  })),\n  recentLogs: Array.from({\n    length: 20\n  }, (_, i) => ({\n    id: `log-${i}`,\n    timestamp: new Date(Date.now() - i * 60 * 60 * 1000).toISOString(),\n    model: ['Claude 3 Sonnet', 'Claude 3.5 Haiku', 'Claude 3 Opus'][Math.floor(Math.random() * 3)],\n    tokens: Math.floor(Math.random() * 5000) + 1000,\n    duration: Math.floor(Math.random() * 3000) + 500,\n    status: Math.random() > 0.1 ? 'success' : 'error'\n  }))\n};\n\n// Axios 인스턴스\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  },\n  timeout: 300000 // 5분\n});\n\n// 요청 인터셉터 - 인증 토큰 자동 추가\napi.interceptors.request.use(async config => {\n  var _config$method;\n  console.log(\"API 요청:\", (_config$method = config.method) === null || _config$method === void 0 ? void 0 : _config$method.toUpperCase(), config.url);\n\n  // 인증이 필요한 요청에 토큰 추가\n  try {\n    var _session$tokens, _session$tokens$idTok;\n    // AuthContext에서 토큰 가져오기 (동적 import 사용)\n    const {\n      fetchAuthSession\n    } = await import('aws-amplify/auth');\n    const session = await fetchAuthSession();\n    const token = session === null || session === void 0 ? void 0 : (_session$tokens = session.tokens) === null || _session$tokens === void 0 ? void 0 : (_session$tokens$idTok = _session$tokens.idToken) === null || _session$tokens$idTok === void 0 ? void 0 : _session$tokens$idTok.toString();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n      console.log(\"✅ 인증 토큰 추가됨\");\n    } else {\n      console.log(\"⚠️ 인증 토큰 없음\");\n    }\n  } catch (error) {\n    console.log(\"📝 인증 토큰 가져오기 실패:\", error.message);\n    // 인증 오류가 있어도 요청은 계속 진행 (public API도 있을 수 있음)\n  }\n  return config;\n});\n\n// 응답 인터셉터 - 401 오류 시 리다이렉션 처리\napi.interceptors.response.use(response => {\n  console.log(\"API 응답:\", response.status, response.config.url);\n  return response;\n}, async error => {\n  var _error$response, _error$config, _error$response2, _error$response3;\n  console.error(\"API 오류 상세:\", {\n    status: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status,\n    message: error.message,\n    code: error.code,\n    url: (_error$config = error.config) === null || _error$config === void 0 ? void 0 : _error$config.url,\n    data: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data\n  });\n\n  // 401 Unauthorized 오류 처리\n  if (((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) === 401) {\n    console.log(\"🔐 인증 오류 발생 - 로그인 페이지로 리다이렉션\");\n    try {\n      // 로그아웃 처리\n      const {\n        signOut\n      } = await import('aws-amplify/auth');\n      await signOut();\n\n      // 로그인 페이지로 리다이렉션\n      window.location.href = '/login';\n    } catch (signOutError) {\n      console.error(\"로그아웃 처리 실패:\", signOutError);\n      // 강제 리다이렉션\n      window.location.href = '/login';\n    }\n  }\n  return Promise.reject(error);\n});\n\n// =============================================================================\n// 🔄 데이터 매핑 유틸리티 함수들\n// =============================================================================\n\n/**\n * 프론트엔드 → 백엔드 데이터 변환\n */\nconst mapFrontendToBackend = {\n  // 채팅 메시지 데이터 변환\n  chatMessage: frontendData => ({\n    userInput: frontendData.userInput || frontendData.message,\n    chat_history: frontendData.chat_history || frontendData.messages || [],\n    prompt_cards: frontendData.promptCards || frontendData.prompt_cards || [],\n    modelId: frontendData.selectedModel || frontendData.modelId,\n    conversationId: frontendData.conversationId || frontendData.conversation_id,\n    userSub: frontendData.userId || frontendData.user_id\n  }),\n  // 프롬프트 카드 데이터 변환\n  promptCard: frontendData => ({\n    title: frontendData.title,\n    prompt_text: frontendData.prompt_text || frontendData.content,\n    tags: frontendData.tags || [],\n    isActive: frontendData.enabled !== false && frontendData.isActive !== false,\n    stepOrder: frontendData.stepOrder || 1\n  }),\n  // 프로젝트 데이터 변환\n  project: frontendData => ({\n    name: frontendData.name,\n    description: frontendData.description || '',\n    tags: frontendData.tags || [],\n    aiRole: frontendData.aiRole || '',\n    aiInstructions: frontendData.aiInstructions || '',\n    targetAudience: frontendData.targetAudience || '일반독자',\n    outputFormat: frontendData.outputFormat || 'multiple',\n    styleGuidelines: frontendData.styleGuidelines || ''\n  })\n};\n\n/**\n * 백엔드 → 프론트엔드 데이터 변환\n */\nconst mapBackendToFrontend = {\n  // 채팅 메시지 변환\n  chatMessage: backendData => ({\n    id: backendData.id || backendData.messageId || Date.now().toString(),\n    role: backendData.role,\n    content: backendData.content || backendData.text,\n    timestamp: backendData.timestamp || backendData.createdAt || new Date().toISOString(),\n    tokenCount: backendData.tokenCount || backendData.tokens_used\n  }),\n  // 프롬프트 카드 변환\n  promptCard: backendData => ({\n    promptId: backendData.promptId || backendData.prompt_id,\n    title: backendData.title,\n    prompt_text: backendData.prompt_text || backendData.content,\n    tags: backendData.tags || [],\n    isActive: backendData.isActive !== false,\n    enabled: backendData.isActive !== false,\n    stepOrder: backendData.stepOrder || 1,\n    createdAt: backendData.createdAt,\n    updatedAt: backendData.updatedAt\n  }),\n  // 프로젝트 변환\n  project: backendData => ({\n    projectId: backendData.projectId,\n    name: backendData.name,\n    description: backendData.description || '',\n    status: backendData.status,\n    tags: backendData.tags || [],\n    aiRole: backendData.aiRole || '',\n    aiInstructions: backendData.aiInstructions || '',\n    targetAudience: backendData.targetAudience || '일반독자',\n    outputFormat: backendData.outputFormat || 'multiple',\n    styleGuidelines: backendData.styleGuidelines || '',\n    createdAt: backendData.createdAt,\n    updatedAt: backendData.updatedAt,\n    promptCount: backendData.promptCount || 0,\n    conversationCount: backendData.conversationCount || 0\n  }),\n  // 대화 목록 변환\n  conversation: backendData => ({\n    id: backendData.id || backendData.conversationId,\n    title: backendData.title,\n    startedAt: backendData.startedAt || backendData.createdAt,\n    lastActivityAt: backendData.lastActivityAt || backendData.updatedAt,\n    tokenSum: backendData.tokenSum || backendData.totalTokens || 0\n  })\n};\n\n/**\n * Mock 데이터와 실제 API 간 전환을 위한 플래그\n */\nconst USE_MOCK_DATA = process.env.REACT_APP_USE_MOCK_DATA === 'true';\n\n/**\n * 🔍 API 연결 상태 확인 함수\n */\nexport const testApiConnection = async () => {\n  console.log(\"🔍 API 연결 상태 확인 중...\");\n  console.log(\"- API Base URL:\", API_BASE_URL);\n  console.log(\"- Use Mock Data:\", USE_MOCK_DATA);\n  console.log(\"- Node Env:\", process.env.NODE_ENV);\n  try {\n    // 간단한 헬스체크 엔드포인트 호출\n    const response = await api.get(\"/health\");\n    console.log(\"✅ API 연결 성공:\", response.status);\n    return {\n      success: true,\n      status: response.status,\n      data: response.data\n    };\n  } catch (error) {\n    var _error$response4, _error$response5;\n    console.log(\"❌ API 연결 실패:\", error.message);\n    console.log(\"- Status:\", (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.status);\n    console.log(\"- Error Code:\", error.code);\n    return {\n      success: false,\n      error: error.message,\n      status: (_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status,\n      code: error.code\n    };\n  }\n};\n\n// =============================================================================\n// 프로젝트 API (기존 유지)\n// =============================================================================\n\nexport const projectAPI = {\n  getProjects: async () => {\n    try {\n      const response = await api.get(\"/projects\");\n      // 백엔드 데이터를 프론트엔드 형식으로 변환\n      const projects = response.data.projects || response.data;\n      return {\n        projects: Array.isArray(projects) ? projects.map(mapBackendToFrontend.project) : [],\n        count: response.data.count || projects.length,\n        hasMore: response.data.hasMore || false,\n        nextKey: response.data.nextKey\n      };\n    } catch (error) {\n      console.error(\"프로젝트 목록 조회 실패:\", error);\n      throw error;\n    }\n  },\n  getProject: async projectId => {\n    try {\n      const response = await api.get(`/projects/${projectId}`);\n      // 백엔드 데이터를 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.project(response.data);\n    } catch (error) {\n      console.error(\"프로젝트 상세 조회 실패:\", error);\n      throw error;\n    }\n  },\n  createProject: async projectData => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.project(projectData);\n      const response = await api.post(\"/projects\", backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.project(response.data);\n    } catch (error) {\n      console.error(\"프로젝트 생성 실패:\", error);\n      throw error;\n    }\n  },\n  updateProject: async (projectId, projectData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.project(projectData);\n      const response = await api.put(`/projects/${projectId}`, backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.project(response.data);\n    } catch (error) {\n      console.error(\"프로젝트 업데이트 실패:\", error);\n      throw error;\n    }\n  },\n  deleteProject: async projectId => {\n    try {\n      const response = await api.delete(`/projects/${projectId}`);\n      return response.data;\n    } catch (error) {\n      console.error(\"프로젝트 삭제 실패:\", error);\n      throw error;\n    }\n  },\n  getUploadUrl: async (projectId, fileName) => {\n    try {\n      const response = await api.get(`/projects/${projectId}/upload-url`, {\n        params: {\n          fileName\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"업로드 URL 생성 실패:\", error);\n      throw error;\n    }\n  }\n};\n\n// =============================================================================\n// 프롬프트 카드 API (기존 유지)\n// =============================================================================\n\nexport const promptCardAPI = {\n  getPromptCards: async (projectId, includeContent = false, includeStats = false) => {\n    try {\n      const response = await api.get(`/prompts/${projectId}`, {\n        params: {\n          includeContent,\n          includeStats\n        }\n      });\n\n      // 백엔드 응답을 프론트엔드 형식으로 변환\n      const promptCards = response.data.promptCards || response.data.prompts || response.data;\n      return {\n        promptCards: Array.isArray(promptCards) ? promptCards.map(mapBackendToFrontend.promptCard) : [],\n        count: response.data.count || promptCards.length\n      };\n    } catch (error) {\n      console.error(\"프롬프트 카드 목록 조회 실패:\", error);\n      throw error;\n    }\n  },\n  createPromptCard: async (projectId, promptData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.promptCard(promptData);\n      const response = await api.post(`/prompts/${projectId}`, backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.promptCard(response.data);\n    } catch (error) {\n      console.error(\"프롬프트 카드 생성 실패:\", error);\n      throw error;\n    }\n  },\n  updatePromptCard: async (projectId, promptId, promptData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.promptCard(promptData);\n      const response = await api.put(`/prompts/${projectId}/${promptId}`, backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.promptCard(response.data);\n    } catch (error) {\n      console.error(\"프롬프트 카드 업데이트 실패:\", error);\n      throw error;\n    }\n  },\n  getPromptContent: async (projectId, promptId) => {\n    try {\n      const response = await api.get(`/prompts/${projectId}/${promptId}/content`);\n      return response.data;\n    } catch (error) {\n      console.error(\"프롬프트 내용 조회 실패:\", error);\n      throw error;\n    }\n  },\n  deletePromptCard: async (projectId, promptId) => {\n    try {\n      const response = await api.delete(`/prompts/${projectId}/${promptId}`);\n      return response.data;\n    } catch (error) {\n      console.error(\"프롬프트 카드 삭제 실패:\", error);\n      throw error;\n    }\n  },\n  reorderPromptCards: async (projectId, reorderData) => {\n    try {\n      const updatePromises = reorderData.map(({\n        promptId,\n        stepOrder\n      }) => api.put(`/prompts/${projectId}/${promptId}`, {\n        stepOrder\n      }));\n      const responses = await Promise.all(updatePromises);\n      return {\n        message: \"프롬프트 카드 순서가 업데이트되었습니다.\",\n        updatedCards: responses.map(r => mapBackendToFrontend.promptCard(r.data))\n      };\n    } catch (error) {\n      console.error(\"프롬프트 카드 순서 변경 실패:\", error);\n      throw error;\n    }\n  }\n};\n\n// =============================================================================\n// 🔧 완전 수정된 제목 생성 API\n// =============================================================================\n\nexport const generateAPI = {\n  generateTitle: async (projectId, data) => {\n    var _data$userInput, _data$chat_history;\n    console.log(\"대화 생성 요청 시작:\", {\n      projectId,\n      inputLength: ((_data$userInput = data.userInput) === null || _data$userInput === void 0 ? void 0 : _data$userInput.length) || 0,\n      historyLength: ((_data$chat_history = data.chat_history) === null || _data$chat_history === void 0 ? void 0 : _data$chat_history.length) || 0,\n      timestamp: new Date().toISOString()\n    });\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.chatMessage(data);\n      console.log(\"🔄 변환된 백엔드 데이터:\", backendData);\n      const response = await api.post(`/projects/${projectId}/generate`, backendData);\n      console.log(\"대화 생성 성공:\", {\n        status: response.status,\n        mode: response.data.mode,\n        message: response.data.message,\n        timestamp: new Date().toISOString()\n      });\n      return response.data;\n    } catch (error) {\n      var _error$response6, _error$response7;\n      console.error(\"대화 생성 실패:\", {\n        code: error.code,\n        message: error.message,\n        status: (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.status,\n        responseData: (_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : _error$response7.data,\n        timestamp: new Date().toISOString()\n      });\n      throw error;\n    }\n  },\n  // 🔧 실제 스트리밍 구현 - Server-Sent Events 사용\n  generateTitleStream: async (projectId, data, onChunk, onError, onComplete) => {\n    var _data$userInput2, _data$chat_history2;\n    console.log(\"스트리밍 대화 생성 요청 시작:\", {\n      projectId,\n      inputLength: ((_data$userInput2 = data.userInput) === null || _data$userInput2 === void 0 ? void 0 : _data$userInput2.length) || 0,\n      historyLength: ((_data$chat_history2 = data.chat_history) === null || _data$chat_history2 === void 0 ? void 0 : _data$chat_history2.length) || 0,\n      timestamp: new Date().toISOString()\n    });\n\n    // 프론트엔드 데이터를 백엔드 형식으로 변환 (try-catch 밖에서 정의)\n    const backendData = mapFrontendToBackend.chatMessage(data);\n    console.log(\"🔄 스트리밍용 변환된 데이터:\", backendData);\n    try {\n      // 1. 먼저 실제 스트리밍 API 시도\n      const streamingUrl = `${API_BASE_URL}/projects/${projectId}/generate/stream`;\n      console.log(\"🚀 실제 스트리밍 API 시도:\", streamingUrl);\n\n      // 인증 토큰 가져오기\n      let authHeaders = {};\n      try {\n        var _session$tokens2, _session$tokens2$idTo;\n        const {\n          fetchAuthSession\n        } = await import('aws-amplify/auth');\n        const session = await fetchAuthSession();\n        const token = session === null || session === void 0 ? void 0 : (_session$tokens2 = session.tokens) === null || _session$tokens2 === void 0 ? void 0 : (_session$tokens2$idTo = _session$tokens2.idToken) === null || _session$tokens2$idTo === void 0 ? void 0 : _session$tokens2$idTo.toString();\n        if (token) {\n          authHeaders.Authorization = `Bearer ${token}`;\n        }\n      } catch (authError) {\n        console.log(\"인증 토큰 가져오기 실패:\", authError.message);\n      }\n      const response = await fetch(streamingUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'text/event-stream',\n          ...authHeaders // 인증 토큰 포함\n        },\n        body: JSON.stringify(backendData) // 변환된 데이터 사용\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      // 2. 응답이 스트리밍 형식인지 확인\n      const contentType = response.headers.get('content-type');\n      if (!contentType || !contentType.includes('text/event-stream')) {\n        console.log(\"❌ 스트리밍 응답이 아님, 폴백 처리\");\n        throw new Error(\"스트리밍 응답이 아닙니다\");\n      }\n\n      // 3. 실제 스트리밍 처리\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n      let fullResponse = '';\n      try {\n        while (true) {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) break;\n          buffer += decoder.decode(value, {\n            stream: true\n          });\n          const lines = buffer.split('\\n');\n          buffer = lines.pop() || '';\n          for (const line of lines) {\n            if (line.startsWith('data: ')) {\n              try {\n                const eventData = JSON.parse(line.slice(6));\n                if (eventData.type === 'start') {\n                  console.log(\"✅ 스트리밍 시작\");\n                } else if (eventData.type === 'chunk') {\n                  fullResponse += eventData.response;\n                  if (onChunk) {\n                    onChunk(eventData.response, {\n                      content: eventData.response\n                    });\n                  }\n                } else if (eventData.type === 'complete') {\n                  console.log(\"✅ 스트리밍 완료\");\n                  if (onComplete) {\n                    onComplete({\n                      result: eventData.fullResponse || fullResponse,\n                      timestamp: new Date().toISOString()\n                    });\n                  }\n                  return {\n                    result: eventData.fullResponse || fullResponse\n                  };\n                } else if (eventData.type === 'error') {\n                  throw new Error(eventData.error);\n                }\n              } catch (parseError) {\n                console.error(\"JSON 파싱 오류:\", parseError);\n              }\n            }\n          }\n        }\n      } finally {\n        reader.releaseLock();\n      }\n      return {\n        result: fullResponse\n      };\n    } catch (streamError) {\n      console.log(\"⚠️ 스트리밍 실패, 폴백 처리:\", streamError.message);\n\n      // 4. 폴백: 일반 API 호출\n      try {\n        const fallbackResponse = await api.post(`/projects/${projectId}/generate`, backendData // 변환된 데이터 사용\n        );\n        console.log(\"✅ 폴백 API 성공:\", {\n          mode: fallbackResponse.data.mode,\n          timestamp: new Date().toISOString()\n        });\n\n        // 폴백 응답을 스트리밍처럼 시뮬레이션\n        if (fallbackResponse.data.result && onChunk) {\n          const fullText = fallbackResponse.data.result;\n          const words = fullText.split(\" \");\n          for (let i = 0; i < words.length; i++) {\n            const word = words[i] + (i < words.length - 1 ? \" \" : \"\");\n            onChunk(word, {\n              content: word\n            });\n            await new Promise(resolve => setTimeout(resolve, 30));\n          }\n        }\n\n        // 완료 콜백 호출\n        if (onComplete) {\n          onComplete({\n            result: fallbackResponse.data.result,\n            model_info: fallbackResponse.data.model_info,\n            performance_metrics: fallbackResponse.data.performance_metrics,\n            timestamp: new Date().toISOString()\n          });\n        }\n        return fallbackResponse.data;\n      } catch (fallbackError) {\n        console.error(\"❌ 폴백 API도 실패:\", fallbackError);\n        if (onError) {\n          onError(new Error(\"서비스에 연결할 수 없습니다. 잠시 후 다시 시도해주세요.\"));\n        }\n        throw new Error(\"서비스를 사용할 수 없습니다.\");\n      }\n    }\n  },\n  getExecutionStatus: async executionArn => {\n    return {\n      status: \"SUCCEEDED\",\n      output: \"{}\"\n    };\n  }\n};\n\n// =============================================================================\n// 🆕 CrewAI 멀티-에이전트 API (새로 추가)\n// =============================================================================\n\nexport const crewAPI = {\n  // 프롬프트 인스턴스 생성 (프롬프트 카드들을 에이전트로 변환)\n  createCrewInstance: async (projectId, promptCards) => {\n    console.log(\"크루 인스턴스 생성 요청:\", {\n      projectId,\n      promptCardsCount: promptCards.length\n    });\n    const response = await api.post(\"/crew/instances\", {\n      projectId,\n      promptCards: promptCards.map(card => ({\n        promptId: card.promptId,\n        prompt_text: card.prompt_text,\n        stepOrder: card.stepOrder,\n        isActive: card.isActive\n      }))\n    });\n    console.log(\"크루 인스턴스 생성 완료:\", response.data);\n    return response.data;\n  },\n  // 프로젝트의 크루 인스턴스 조회\n  getCrewInstances: async projectId => {\n    console.log(\"크루 인스턴스 조회:\", {\n      projectId\n    });\n    const response = await api.get(`/crew/instances/${projectId}`);\n    return response.data;\n  },\n  // 크루 설정 조회\n  getCrewConfig: async projectId => {\n    console.log(\"크루 설정 조회:\", {\n      projectId\n    });\n    const response = await api.get(`/crew/config/${projectId}`);\n    return response.data;\n  },\n  // 🌟 멀티-에이전트 병렬 실행 (핵심 기능)\n  executeMultiAgent: async (projectId, userInput, onProgress = null) => {\n    console.log(\"멀티-에이전트 실행 시작:\", {\n      projectId,\n      inputLength: userInput.length,\n      timestamp: new Date().toISOString()\n    });\n    try {\n      const response = await api.post(\"/crew/execute\", {\n        projectId,\n        userInput,\n        mode: \"parallel\" // 병렬 처리 모드 명시\n      });\n      console.log(\"멀티-에이전트 실행 완료:\", {\n        agentCount: Object.keys(response.data.agentResults || {}).length,\n        titleCount: Object.keys(response.data.finalTitles || {}).length,\n        tokenUsage: response.data.tokenUsage,\n        timestamp: new Date().toISOString()\n      });\n      return response.data;\n    } catch (error) {\n      var _error$response8, _error$response9;\n      console.error(\"멀티-에이전트 실행 실패:\", {\n        error: error.message,\n        status: (_error$response8 = error.response) === null || _error$response8 === void 0 ? void 0 : _error$response8.status,\n        data: (_error$response9 = error.response) === null || _error$response9 === void 0 ? void 0 : _error$response9.data,\n        timestamp: new Date().toISOString()\n      });\n      throw error;\n    }\n  },\n  // 에이전트별 상세 결과 조회\n  getAgentResults: async (projectId, executionId) => {\n    console.log(\"에이전트 결과 조회:\", {\n      projectId,\n      executionId\n    });\n    const response = await api.get(`/crew/results/${projectId}/${executionId}`);\n    return response.data;\n  }\n};\n\n// =============================================================================\n// 채팅 API (기존 유지)\n// =============================================================================\n\nexport const chatAPI = {\n  sendMessage: async (projectId, message, sessionId, userId = \"default\") => {\n    console.log(\"채팅 메시지를 generate API로 전달:\", {\n      projectId,\n      message,\n      sessionId,\n      userId\n    });\n    try {\n      const response = await generateAPI.generateTitle(projectId, {\n        userInput: message,\n        userRequest: \"\",\n        chat_history: []\n      });\n      return {\n        response: response.result,\n        sessionId,\n        userId,\n        timestamp: new Date().toISOString(),\n        mode: response.mode || \"chat\"\n      };\n    } catch (error) {\n      console.error(\"채팅 메시지 처리 실패:\", error);\n      throw error;\n    }\n  },\n  getChatHistory: async (projectId, sessionId, userId = \"default\") => {\n    console.log(\"채팅 히스토리 조회:\", {\n      projectId,\n      sessionId,\n      userId\n    });\n    return {\n      messages: [],\n      sessionId,\n      userId,\n      message: \"채팅 히스토리는 현재 지원되지 않습니다. 각 메시지는 독립적으로 처리됩니다.\"\n    };\n  },\n  getChatSessions: async (projectId, userId = \"default\") => {\n    console.log(\"채팅 세션 목록 조회:\", {\n      projectId,\n      userId\n    });\n    return {\n      sessions: [],\n      message: \"채팅 세션은 현재 지원되지 않습니다. 각 대화는 독립적으로 처리됩니다.\"\n    };\n  },\n  deleteChatSession: async (projectId, sessionId, userId = \"default\") => {\n    console.log(\"채팅 세션 삭제:\", {\n      projectId,\n      sessionId,\n      userId\n    });\n    return {\n      message: \"채팅 세션 삭제가 완료되었습니다.\",\n      sessionId,\n      userId\n    };\n  }\n};\n\n// =============================================================================\n// 인증 API (기존 유지)\n// =============================================================================\n\nexport const authAPI = {\n  isAuthenticated: () => {\n    return true;\n  },\n  getCurrentUser: () => {\n    return {\n      id: \"user\",\n      email: \"user@example.com\",\n      name: \"사용자\"\n    };\n  },\n  signin: async credentials => {\n    const response = await api.post(\"/auth/signin\", credentials);\n    return response.data;\n  },\n  signup: async userData => {\n    const response = await api.post(\"/auth/signup\", userData);\n    return response.data;\n  },\n  signout: async () => {\n    const response = await api.post(\"/auth/signout\");\n    return response.data;\n  },\n  verifyEmail: async verificationData => {\n    const response = await api.post(\"/auth/verify-email\", verificationData);\n    return response.data;\n  },\n  forgotPassword: async email => {\n    const response = await api.post(\"/auth/forgot-password\", {\n      email\n    });\n    return response.data;\n  },\n  confirmPassword: async resetData => {\n    const response = await api.post(\"/auth/confirm-password\", resetData);\n    return response.data;\n  },\n  // 비밀번호 찾기 - 인증번호 발송\n  requestPasswordReset: async email => {\n    const response = await api.post(\"/auth/forgot-password\", {\n      email\n    });\n    return response.data;\n  },\n  // 비밀번호 재설정 - 인증번호와 새 비밀번호로 재설정\n  resetPassword: async resetData => {\n    const response = await api.post(\"/auth/confirm-password\", {\n      email: resetData.email,\n      code: resetData.code,\n      newPassword: resetData.newPassword\n    });\n    return response.data;\n  }\n};\n\n// =============================================================================\n// 🔧 개선된 오류 처리 함수\n// =============================================================================\n\nexport const handleAPIError = async error => {\n  var _error$response0, _error$response1, _error$response10, _error$response11, _error$response12, _error$response13, _error$message, _error$message2;\n  console.error(\"API 오류 상세 분석:\", {\n    message: error.message,\n    code: error.code,\n    status: (_error$response0 = error.response) === null || _error$response0 === void 0 ? void 0 : _error$response0.status,\n    statusText: (_error$response1 = error.response) === null || _error$response1 === void 0 ? void 0 : _error$response1.statusText,\n    data: (_error$response10 = error.response) === null || _error$response10 === void 0 ? void 0 : _error$response10.data,\n    timestamp: new Date().toISOString()\n  });\n\n  // 401 Unauthorized 특별 처리 - 로그인 페이지로 리다이렉트\n  if (((_error$response11 = error.response) === null || _error$response11 === void 0 ? void 0 : _error$response11.status) === 401) {\n    try {\n      // AuthContext에서 로그아웃 처리\n      const {\n        signOut\n      } = await import('aws-amplify/auth');\n      await signOut();\n\n      // 로그인 페이지로 리다이렉트\n      window.location.href = '/auth/signin';\n      return {\n        userMessage: \"인증이 만료되었습니다. 다시 로그인해주세요.\",\n        statusCode: 401,\n        errorType: \"UNAUTHORIZED\",\n        shouldRedirect: true\n      };\n    } catch (signOutError) {\n      console.error(\"로그아웃 처리 실패:\", signOutError);\n      // 로그아웃 실패해도 리다이렉트\n      window.location.href = '/auth/signin';\n      return {\n        userMessage: \"인증이 만료되었습니다. 다시 로그인해주세요.\",\n        statusCode: 401,\n        errorType: \"UNAUTHORIZED\",\n        shouldRedirect: true\n      };\n    }\n  }\n\n  // 403 Forbidden 특별 처리\n  if (((_error$response12 = error.response) === null || _error$response12 === void 0 ? void 0 : _error$response12.status) === 403) {\n    return {\n      userMessage: \"API 접근이 차단되었습니다. 관리자에게 문의하세요.\",\n      statusCode: 403,\n      errorType: \"FORBIDDEN\",\n      shouldRedirect: false\n    };\n  }\n\n  // Gateway Timeout 특별 처리\n  if (((_error$response13 = error.response) === null || _error$response13 === void 0 ? void 0 : _error$response13.status) === 504) {\n    return {\n      userMessage: \"서버 응답 시간이 초과되었습니다. 요청을 간소화하거나 잠시 후 다시 시도해주세요.\",\n      statusCode: 504,\n      errorType: \"GATEWAY_TIMEOUT\",\n      shouldRedirect: false\n    };\n  }\n\n  // CORS 오류 특별 처리\n  if ((_error$message = error.message) !== null && _error$message !== void 0 && _error$message.includes(\"CORS\") || error.code === \"ERR_NETWORK\" || (_error$message2 = error.message) !== null && _error$message2 !== void 0 && _error$message2.includes(\"Access-Control-Allow-Origin\")) {\n    return {\n      userMessage: \"서버 연결 설정에 문제가 있습니다. 페이지를 새로고침하고 다시 시도해주세요.\",\n      statusCode: 0,\n      errorType: \"CORS_ERROR\",\n      shouldRedirect: false\n    };\n  }\n\n  // 타임아웃 오류 특별 처리\n  if (error.code === \"ECONNABORTED\") {\n    return {\n      userMessage: \"요청 처리 시간이 초과되었습니다. 입력을 줄이거나 잠시 후 다시 시도해주세요.\",\n      statusCode: 0,\n      errorType: \"TIMEOUT_ERROR\",\n      shouldRedirect: false\n    };\n  }\n  if (error.response) {\n    var _error$response$data, _error$response$data2;\n    const status = error.response.status;\n    const message = ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || ((_error$response$data2 = error.response.data) === null || _error$response$data2 === void 0 ? void 0 : _error$response$data2.error) || \"서버 오류가 발생했습니다\";\n    switch (status) {\n      case 400:\n        return {\n          userMessage: `잘못된 요청: ${message}`,\n          statusCode: 400,\n          shouldRedirect: false\n        };\n      case 404:\n        return {\n          userMessage: \"요청한 리소스를 찾을 수 없습니다\",\n          statusCode: 404,\n          shouldRedirect: false\n        };\n      case 429:\n        return {\n          userMessage: \"요청이 너무 많습니다. 잠시 후 다시 시도해주세요\",\n          statusCode: 429,\n          shouldRedirect: false\n        };\n      case 500:\n        return {\n          userMessage: \"서버 내부 오류가 발생했습니다\",\n          statusCode: 500,\n          shouldRedirect: false\n        };\n      default:\n        return {\n          userMessage: `서버 오류 (${status}): ${message}`,\n          statusCode: status,\n          shouldRedirect: false\n        };\n    }\n  } else if (error.request) {\n    return {\n      userMessage: \"서버에 연결할 수 없습니다. 네트워크 연결을 확인해주세요\",\n      statusCode: 0,\n      errorType: \"NETWORK_ERROR\",\n      shouldRedirect: false\n    };\n  } else {\n    return {\n      userMessage: `요청 오류: ${error.message}`,\n      statusCode: -1,\n      errorType: \"REQUEST_ERROR\",\n      shouldRedirect: false\n    };\n  }\n};\n\n// =============================================================================\n// 기타 유틸리티 함수들 (기존 유지)\n// =============================================================================\n\nexport const DYNAMIC_PROMPT_SYSTEM = {\n  message: \"원하는 만큼 프롬프트 카드를 생성하여 나만의 AI 어시스턴트를 만들어보세요!\",\n  maxPromptCards: 50,\n  supportedFormats: [\"text\", \"markdown\"],\n  defaultStepOrder: 1\n};\nexport const COLOR_OPTIONS = [{\n  id: \"blue\",\n  name: \"파랑\",\n  bgClass: \"bg-blue-100\",\n  textClass: \"text-blue-800\",\n  borderClass: \"border-blue-200\"\n}, {\n  id: \"green\",\n  name: \"초록\",\n  bgClass: \"bg-green-100\",\n  textClass: \"text-green-800\",\n  borderClass: \"border-green-200\"\n}, {\n  id: \"purple\",\n  name: \"보라\",\n  bgClass: \"bg-purple-100\",\n  textClass: \"text-purple-800\",\n  borderClass: \"border-purple-200\"\n}, {\n  id: \"orange\",\n  name: \"주황\",\n  bgClass: \"bg-orange-100\",\n  textClass: \"text-orange-800\",\n  borderClass: \"border-orange-200\"\n}, {\n  id: \"red\",\n  name: \"빨강\",\n  bgClass: \"bg-red-100\",\n  textClass: \"text-red-800\",\n  borderClass: \"border-red-200\"\n}, {\n  id: \"indigo\",\n  name: \"남색\",\n  bgClass: \"bg-indigo-100\",\n  textClass: \"text-indigo-800\",\n  borderClass: \"border-indigo-200\"\n}, {\n  id: \"pink\",\n  name: \"분홍\",\n  bgClass: \"bg-pink-100\",\n  textClass: \"text-pink-800\",\n  borderClass: \"border-pink-200\"\n}, {\n  id: \"yellow\",\n  name: \"노랑\",\n  bgClass: \"bg-yellow-100\",\n  textClass: \"text-yellow-800\",\n  borderClass: \"border-yellow-200\"\n}, {\n  id: \"gray\",\n  name: \"회색\",\n  bgClass: \"bg-gray-100\",\n  textClass: \"text-gray-800\",\n  borderClass: \"border-gray-200\"\n}];\nexport const getPromptCardInfo = promptCard => {\n  return {\n    id: promptCard.promptId || promptCard.id,\n    title: promptCard.title || \"새 프롬프트 카드\",\n    color: promptCard.color || \"gray\",\n    description: promptCard.description || \"\",\n    stepOrder: promptCard.stepOrder || 1,\n    isActive: promptCard.isActive !== false\n  };\n};\nexport const filterProjects = (projects, filters) => {\n  let filtered = [...projects];\n  if (filters.searchQuery) {\n    const query = filters.searchQuery.toLowerCase();\n    filtered = filtered.filter(project => {\n      var _project$name, _project$description, _project$tags;\n      return ((_project$name = project.name) === null || _project$name === void 0 ? void 0 : _project$name.toLowerCase().includes(query)) || ((_project$description = project.description) === null || _project$description === void 0 ? void 0 : _project$description.toLowerCase().includes(query)) || ((_project$tags = project.tags) === null || _project$tags === void 0 ? void 0 : _project$tags.some(tag => tag.toLowerCase().includes(query)));\n    });\n  }\n  switch (filters.sortBy) {\n    case \"created\":\n      filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n      break;\n    case \"updated\":\n      filtered.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n      break;\n    case \"name\":\n      filtered.sort((a, b) => {\n        var _a$name;\n        return (_a$name = a.name) === null || _a$name === void 0 ? void 0 : _a$name.localeCompare(b.name);\n      });\n      break;\n    default:\n      break;\n  }\n  return filtered;\n};\nexport const formatTokenCount = count => {\n  if (count >= 1000) {\n    return `${(count / 1000).toFixed(1)}K`;\n  }\n  return count.toString();\n};\nexport const formatFileSize = bytes => {\n  if (bytes >= 1024) {\n    return `${(bytes / 1024).toFixed(1)}KB`;\n  }\n  return `${bytes}B`;\n};\nexport const calculatePromptStats = promptCards => {\n  if (!promptCards || promptCards.length === 0) {\n    return {\n      totalCards: 0,\n      totalTokens: 0,\n      averageTokens: 0,\n      activeCards: 0,\n      maxStepOrder: 0,\n      hasCustomOrder: false\n    };\n  }\n  const activeCards = promptCards.filter(card => card.isActive !== false);\n  const totalTokens = activeCards.reduce((sum, card) => {\n    return sum + (card.tokenCount || card.contentLength || 0);\n  }, 0);\n  const stepOrders = activeCards.map(card => card.stepOrder || 0).filter(step => step > 0);\n  const hasCustomOrder = stepOrders.length > 0;\n  const maxStepOrder = stepOrders.length > 0 ? Math.max(...stepOrders) : 0;\n  return {\n    totalCards: promptCards.length,\n    activeCards: activeCards.length,\n    totalTokens,\n    averageTokens: activeCards.length > 0 ? Math.round(totalTokens / activeCards.length) : 0,\n    maxStepOrder,\n    hasCustomOrder,\n    stepOrderRange: {\n      min: stepOrders.length > 0 ? Math.min(...stepOrders) : 0,\n      max: maxStepOrder\n    }\n  };\n};\n\n// =============================================================================\n// Usage API (Dashboard용)\n// =============================================================================\n\nexport const getUsage = async (range = 'month') => {\n  console.log(\"사용량 데이터 조회 요청:\", {\n    range\n  });\n\n  // Mock 데이터 사용 모드이거나 개발 모드일 때\n  if (USE_MOCK_DATA || process.env.NODE_ENV === 'development') {\n    console.log(\"🔄 Mock 사용량 데이터 반환\");\n    // Simulate API delay\n    await new Promise(resolve => setTimeout(resolve, 500));\n    return mockUsageData;\n  }\n  try {\n    const response = await api.get(`/usage?range=${range}`);\n    console.log(\"✅ 사용량 API 호출 성공\");\n    return response.data;\n  } catch (error) {\n    console.warn(\"⚠️ 사용량 API 호출 실패, Mock 데이터로 폴백:\", error.message);\n    // Fallback to mock data\n    return mockUsageData;\n  }\n};\n\n// =============================================================================\n// 🆕 Conversation History API\n// =============================================================================\n\nexport const conversationAPI = {\n  // 대화 목록 조회 (무한 스크롤)\n  getConversations: async (cursor, limit = 20) => {\n    console.log(\"대화 목록 조회 시작:\", {\n      cursor,\n      limit,\n      API_BASE_URL\n    });\n    const params = new URLSearchParams({\n      limit: limit.toString()\n    });\n    if (cursor) {\n      params.append('cursor', cursor);\n    }\n    const url = `/conversations?${params}`;\n    console.log(\"API 요청 URL:\", `${API_BASE_URL}${url}`);\n    try {\n      const response = await api.get(url);\n      console.log(\"대화 목록 조회 성공:\", response.data);\n\n      // 백엔드 응답을 프론트엔드 형식으로 변환\n      const conversations = response.data.conversations || response.data.items || response.data;\n      return {\n        conversations: Array.isArray(conversations) ? conversations.map(mapBackendToFrontend.conversation) : [],\n        hasMore: response.data.hasMore || false,\n        nextCursor: response.data.nextCursor || response.data.cursor\n      };\n    } catch (error) {\n      console.error(\"대화 목록 조회 실패:\", error);\n      // Mock 데이터로 폴백 (개발 시)\n      if (USE_MOCK_DATA || process.env.NODE_ENV === 'development') {\n        console.log(\"🔄 Mock 데이터로 폴백\");\n        return {\n          conversations: mockConversations,\n          hasMore: false,\n          nextCursor: null\n        };\n      }\n      throw error;\n    }\n  },\n  // 새 대화 생성\n  createConversation: async (title = 'New Conversation') => {\n    console.log(\"새 대화 생성:\", {\n      title\n    });\n    try {\n      const response = await api.post('/conversations', {\n        title\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"대화 생성 실패:\", error);\n      throw error;\n    }\n  },\n  // 특정 대화의 메시지 조회 (페이징)\n  getMessages: async (conversationId, cursor, limit = 50) => {\n    console.log(\"메시지 조회:\", {\n      conversationId,\n      cursor,\n      limit\n    });\n    const params = new URLSearchParams({\n      convId: conversationId,\n      limit: limit.toString()\n    });\n    if (cursor) {\n      params.append('cursor', cursor);\n    }\n    try {\n      const response = await api.get(`/messages?${params}`);\n\n      // 백엔드 응답을 프론트엔드 형식으로 변환\n      const messages = response.data.messages || response.data.items || response.data;\n      return {\n        messages: Array.isArray(messages) ? messages.map(mapBackendToFrontend.chatMessage) : [],\n        hasMore: response.data.hasMore || false,\n        nextCursor: response.data.nextCursor || response.data.cursor\n      };\n    } catch (error) {\n      console.error(\"메시지 조회 실패:\", error);\n      // Mock 데이터로 폴백 (개발 시)\n      if (USE_MOCK_DATA || process.env.NODE_ENV === 'development') {\n        console.log(\"🔄 Mock 메시지 데이터로 폴백\");\n        const mockMessageData = mockMessages[conversationId] || [];\n        return {\n          messages: mockMessageData,\n          hasMore: false,\n          nextCursor: null\n        };\n      }\n      throw error;\n    }\n  },\n  // 대화 삭제\n  deleteConversation: async conversationId => {\n    console.log(\"대화 삭제:\", {\n      conversationId\n    });\n    try {\n      const response = await api.delete(`/conversations/${conversationId}`);\n      console.log(\"대화 삭제 성공:\", response.data);\n      return response.data;\n    } catch (error) {\n      console.error(\"대화 삭제 실패:\", error);\n      throw error;\n    }\n  }\n};\n\n// Mock data for conversation development\nexport const mockConversations = [{\n  id: '1',\n  title: '서울경제신문 AI 제목 생성 테스트',\n  startedAt: '2025-01-20T10:30:00Z',\n  lastActivityAt: '2025-01-20T15:45:00Z',\n  tokenSum: 1250\n}, {\n  id: '2',\n  title: '경제 뉴스 헤드라인 최적화',\n  startedAt: '2025-01-19T14:20:00Z',\n  lastActivityAt: '2025-01-19T16:30:00Z',\n  tokenSum: 890\n}, {\n  id: '3',\n  title: '부동산 시장 분석 제목 생성',\n  startedAt: '2025-01-18T09:15:00Z',\n  lastActivityAt: '2025-01-18T11:45:00Z',\n  tokenSum: 2150\n}];\nexport const mockMessages = {\n  '1': [{\n    id: '2025-01-20T10:30:00.000Z',\n    role: 'user',\n    content: '오늘 서울 부동산 시장 현황에 대한 기사 제목을 만들어주세요.',\n    tokenCount: 25,\n    timestamp: '2025-01-20T10:30:00.000Z'\n  }, {\n    id: '2025-01-20T10:30:05.000Z',\n    role: 'assistant',\n    content: '서울 부동산 시장 현황에 대한 몇 가지 제목 옵션을 제안해드리겠습니다:\\n\\n1. \"서울 아파트값 3개월 연속 하락세... 매수심리 위축\"\\n2. \"강남·서초구 고가 아파트 거래 급감, 시장 관망세 지속\"\\n3. \"서울 부동산 시장 \\'관망론\\' 확산... 전세시장은 여전히 불안\"',\n    tokenCount: 95,\n    timestamp: '2025-01-20T10:30:05.000Z'\n  }],\n  '2': [{\n    id: '2025-01-19T14:20:00.000Z',\n    role: 'user',\n    content: '반도체 산업 관련 경제 뉴스 제목을 생성해주세요.',\n    tokenCount: 20,\n    timestamp: '2025-01-19T14:20:00.000Z'\n  }, {\n    id: '2025-01-19T14:20:03.000Z',\n    role: 'assistant',\n    content: '반도체 산업 관련 경제 뉴스 제목들을 제안드립니다:\\n\\n1. \"삼성전자 메모리 반도체 수요 회복 기대감... 주가 상승세\"\\n2. \"AI 칩 수요 급증에 SK하이닉스 4분기 실적 개선 전망\"\\n3. \"중국 반도체 굴기 vs 한국 기술력... 글로벌 경쟁 심화\"',\n    tokenCount: 78,\n    timestamp: '2025-01-19T14:20:03.000Z'\n  }]\n};\n\n// =============================================================================\n// 🧪 연결 테스트 및 상태 확인 함수들\n// =============================================================================\n\n/**\n * 🧪 REST API 연결 테스트 함수\n */\nexport const testAPIConnection = async () => {\n  try {\n    console.log(\"🔍 API 연결 테스트 시작...\");\n    const response = await api.get(\"/health\", {\n      timeout: 5000 // 5초 타임아웃\n    });\n    console.log(\"✅ API 연결 테스트 성공:\", response.data);\n    return {\n      success: true,\n      message: \"백엔드 서버 연결 성공\",\n      data: response.data\n    };\n  } catch (error) {\n    var _error$response14, _error$response15, _error$response16;\n    console.error(\"❌ API 연결 테스트 실패:\", error);\n    let errorMessage = \"백엔드 서버 연결 실패\";\n    if (error.code === \"ECONNABORTED\") {\n      errorMessage = \"연결 시간 초과 - 서버가 응답하지 않습니다\";\n    } else if (((_error$response14 = error.response) === null || _error$response14 === void 0 ? void 0 : _error$response14.status) === 404) {\n      errorMessage = \"health 엔드포인트가 존재하지 않습니다\";\n    } else if (((_error$response15 = error.response) === null || _error$response15 === void 0 ? void 0 : _error$response15.status) >= 500) {\n      errorMessage = \"서버 내부 오류가 발생했습니다\";\n    } else if (!error.response) {\n      errorMessage = \"네트워크 연결 오류 - 서버에 도달할 수 없습니다\";\n    }\n    return {\n      success: false,\n      message: errorMessage,\n      error: error.message,\n      status: (_error$response16 = error.response) === null || _error$response16 === void 0 ? void 0 : _error$response16.status\n    };\n  }\n};\n\n/**\n * 🔄 종합 연결 상태 확인 (REST API + WebSocket)\n */\nexport const checkConnectionStatus = async () => {\n  console.log(\"🔍 종합 연결 상태 확인 시작...\");\n  const results = {\n    timestamp: new Date().toISOString(),\n    restApi: null,\n    websocket: null,\n    authentication: null\n  };\n\n  // 1. REST API 연결 테스트\n  try {\n    results.restApi = await testAPIConnection();\n  } catch (error) {\n    results.restApi = {\n      success: false,\n      message: \"REST API 테스트 중 오류 발생\",\n      error: error.message\n    };\n  }\n\n  // 2. 인증 상태 확인\n  try {\n    var _session$tokens3, _session$tokens3$idTo;\n    const {\n      fetchAuthSession\n    } = await import('aws-amplify/auth');\n    const session = await fetchAuthSession();\n    const token = session === null || session === void 0 ? void 0 : (_session$tokens3 = session.tokens) === null || _session$tokens3 === void 0 ? void 0 : (_session$tokens3$idTo = _session$tokens3.idToken) === null || _session$tokens3$idTo === void 0 ? void 0 : _session$tokens3$idTo.toString();\n    results.authentication = {\n      success: !!token,\n      message: token ? \"인증 토큰 확인됨\" : \"인증 토큰 없음\",\n      hasToken: !!token\n    };\n  } catch (error) {\n    results.authentication = {\n      success: false,\n      message: \"인증 상태 확인 실패\",\n      error: error.message\n    };\n  }\n\n  // 3. WebSocket URL 확인\n  try {\n    const wsUrl = process.env.REACT_APP_WS_URL;\n    results.websocket = {\n      success: !!wsUrl && (wsUrl.startsWith('wss://') || wsUrl.startsWith('ws://')),\n      message: !!wsUrl ? \"WebSocket URL 설정됨\" : \"WebSocket URL 미설정\",\n      url: wsUrl ? wsUrl.replace(/token=[^&]+/, 'token=***') : null\n    };\n  } catch (error) {\n    results.websocket = {\n      success: false,\n      message: \"WebSocket 설정 확인 실패\",\n      error: error.message\n    };\n  }\n  console.log(\"📊 종합 연결 상태 결과:\", results);\n  return results;\n};","map":{"version":3,"names":["axios","API_BASE_URL","process","env","REACT_APP_API_URL","mockUsageData","todayRequests","todayTokens","monthlyLimit","monthlyUsed","plan","name","expiresAt","features","chartData","Array","from","length","_","i","date","Date","now","toISOString","split","tokens","Math","floor","random","requests","recentLogs","id","timestamp","model","duration","status","api","create","baseURL","headers","timeout","interceptors","request","use","config","_config$method","console","log","method","toUpperCase","url","_session$tokens","_session$tokens$idTok","fetchAuthSession","session","token","idToken","toString","Authorization","error","message","response","_error$response","_error$config","_error$response2","_error$response3","code","data","signOut","window","location","href","signOutError","Promise","reject","mapFrontendToBackend","chatMessage","frontendData","userInput","chat_history","messages","prompt_cards","promptCards","modelId","selectedModel","conversationId","conversation_id","userSub","userId","user_id","promptCard","title","prompt_text","content","tags","isActive","enabled","stepOrder","project","description","aiRole","aiInstructions","targetAudience","outputFormat","styleGuidelines","mapBackendToFrontend","backendData","messageId","role","text","createdAt","tokenCount","tokens_used","promptId","prompt_id","updatedAt","projectId","promptCount","conversationCount","conversation","startedAt","lastActivityAt","tokenSum","totalTokens","USE_MOCK_DATA","REACT_APP_USE_MOCK_DATA","testApiConnection","NODE_ENV","get","success","_error$response4","_error$response5","projectAPI","getProjects","projects","isArray","map","count","hasMore","nextKey","getProject","createProject","projectData","post","updateProject","put","deleteProject","delete","getUploadUrl","fileName","params","promptCardAPI","getPromptCards","includeContent","includeStats","prompts","createPromptCard","promptData","updatePromptCard","getPromptContent","deletePromptCard","reorderPromptCards","reorderData","updatePromises","responses","all","updatedCards","r","generateAPI","generateTitle","_data$userInput","_data$chat_history","inputLength","historyLength","mode","_error$response6","_error$response7","responseData","generateTitleStream","onChunk","onError","onComplete","_data$userInput2","_data$chat_history2","streamingUrl","authHeaders","_session$tokens2","_session$tokens2$idTo","authError","fetch","body","JSON","stringify","ok","Error","statusText","contentType","includes","reader","getReader","decoder","TextDecoder","buffer","fullResponse","done","value","read","decode","stream","lines","pop","line","startsWith","eventData","parse","slice","type","result","parseError","releaseLock","streamError","fallbackResponse","fullText","words","word","resolve","setTimeout","model_info","performance_metrics","fallbackError","getExecutionStatus","executionArn","output","crewAPI","createCrewInstance","promptCardsCount","card","getCrewInstances","getCrewConfig","executeMultiAgent","onProgress","agentCount","Object","keys","agentResults","titleCount","finalTitles","tokenUsage","_error$response8","_error$response9","getAgentResults","executionId","chatAPI","sendMessage","sessionId","userRequest","getChatHistory","getChatSessions","sessions","deleteChatSession","authAPI","isAuthenticated","getCurrentUser","email","signin","credentials","signup","userData","signout","verifyEmail","verificationData","forgotPassword","confirmPassword","resetData","requestPasswordReset","resetPassword","newPassword","handleAPIError","_error$response0","_error$response1","_error$response10","_error$response11","_error$response12","_error$response13","_error$message","_error$message2","userMessage","statusCode","errorType","shouldRedirect","_error$response$data","_error$response$data2","DYNAMIC_PROMPT_SYSTEM","maxPromptCards","supportedFormats","defaultStepOrder","COLOR_OPTIONS","bgClass","textClass","borderClass","getPromptCardInfo","color","filterProjects","filters","filtered","searchQuery","query","toLowerCase","filter","_project$name","_project$description","_project$tags","some","tag","sortBy","sort","a","b","_a$name","localeCompare","formatTokenCount","toFixed","formatFileSize","bytes","calculatePromptStats","totalCards","averageTokens","activeCards","maxStepOrder","hasCustomOrder","reduce","sum","contentLength","stepOrders","step","max","round","stepOrderRange","min","getUsage","range","warn","conversationAPI","getConversations","cursor","limit","URLSearchParams","append","conversations","items","nextCursor","mockConversations","createConversation","getMessages","convId","mockMessageData","mockMessages","deleteConversation","testAPIConnection","_error$response14","_error$response15","_error$response16","errorMessage","checkConnectionStatus","results","restApi","websocket","authentication","_session$tokens3","_session$tokens3$idTo","hasToken","wsUrl","REACT_APP_WS_URL","replace"],"sources":["/Users/yeong-gwang/Documents/work/서울경제신문/dev/nexus/title_generator_ver1/frontend/src/services/api.js"],"sourcesContent":["import axios from \"axios\";\n\n// API 기본 설정\nconst API_BASE_URL = process.env.REACT_APP_API_URL || \"https://nq5qrt16lb.execute-api.us-east-1.amazonaws.com/prod\";\n\n// Mock data for development\nconst mockUsageData = {\n  todayRequests: 127,\n  todayTokens: 45320,\n  monthlyLimit: 1000000,\n  monthlyUsed: 523400,\n  plan: {\n    name: 'Professional',\n    expiresAt: '2025-02-28',\n    features: ['월 100만 토큰', '우선 지원', 'API 액세스']\n  },\n  chartData: Array.from({ length: 30 }, (_, i) => ({\n    date: new Date(Date.now() - (29 - i) * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n    tokens: Math.floor(Math.random() * 30000) + 10000,\n    requests: Math.floor(Math.random() * 100) + 50\n  })),\n  recentLogs: Array.from({ length: 20 }, (_, i) => ({\n    id: `log-${i}`,\n    timestamp: new Date(Date.now() - i * 60 * 60 * 1000).toISOString(),\n    model: ['Claude 3 Sonnet', 'Claude 3.5 Haiku', 'Claude 3 Opus'][Math.floor(Math.random() * 3)],\n    tokens: Math.floor(Math.random() * 5000) + 1000,\n    duration: Math.floor(Math.random() * 3000) + 500,\n    status: Math.random() > 0.1 ? 'success' : 'error'\n  }))\n};\n\n// Axios 인스턴스\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: { \"Content-Type\": \"application/json\" },\n  timeout: 300000, // 5분\n});\n\n// 요청 인터셉터 - 인증 토큰 자동 추가\napi.interceptors.request.use(async (config) => {\n  console.log(\"API 요청:\", config.method?.toUpperCase(), config.url);\n  \n  // 인증이 필요한 요청에 토큰 추가\n  try {\n    // AuthContext에서 토큰 가져오기 (동적 import 사용)\n    const { fetchAuthSession } = await import('aws-amplify/auth');\n    const session = await fetchAuthSession();\n    const token = session?.tokens?.idToken?.toString();\n    \n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n      console.log(\"✅ 인증 토큰 추가됨\");\n    } else {\n      console.log(\"⚠️ 인증 토큰 없음\");\n    }\n  } catch (error) {\n    console.log(\"📝 인증 토큰 가져오기 실패:\", error.message);\n    // 인증 오류가 있어도 요청은 계속 진행 (public API도 있을 수 있음)\n  }\n  \n  return config;\n});\n\n// 응답 인터셉터 - 401 오류 시 리다이렉션 처리\napi.interceptors.response.use(\n  (response) => {\n    console.log(\"API 응답:\", response.status, response.config.url);\n    return response;\n  },\n  async (error) => {\n    console.error(\"API 오류 상세:\", {\n      status: error.response?.status,\n      message: error.message,\n      code: error.code,\n      url: error.config?.url,\n      data: error.response?.data,\n    });\n\n    // 401 Unauthorized 오류 처리\n    if (error.response?.status === 401) {\n      console.log(\"🔐 인증 오류 발생 - 로그인 페이지로 리다이렉션\");\n      \n      try {\n        // 로그아웃 처리\n        const { signOut } = await import('aws-amplify/auth');\n        await signOut();\n        \n        // 로그인 페이지로 리다이렉션\n        window.location.href = '/login';\n      } catch (signOutError) {\n        console.error(\"로그아웃 처리 실패:\", signOutError);\n        // 강제 리다이렉션\n        window.location.href = '/login';\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\n// =============================================================================\n// 🔄 데이터 매핑 유틸리티 함수들\n// =============================================================================\n\n/**\n * 프론트엔드 → 백엔드 데이터 변환\n */\nconst mapFrontendToBackend = {\n  // 채팅 메시지 데이터 변환\n  chatMessage: (frontendData) => ({\n    userInput: frontendData.userInput || frontendData.message,\n    chat_history: frontendData.chat_history || frontendData.messages || [],\n    prompt_cards: frontendData.promptCards || frontendData.prompt_cards || [],\n    modelId: frontendData.selectedModel || frontendData.modelId,\n    conversationId: frontendData.conversationId || frontendData.conversation_id,\n    userSub: frontendData.userId || frontendData.user_id,\n  }),\n\n  // 프롬프트 카드 데이터 변환\n  promptCard: (frontendData) => ({\n    title: frontendData.title,\n    prompt_text: frontendData.prompt_text || frontendData.content,\n    tags: frontendData.tags || [],\n    isActive: frontendData.enabled !== false && frontendData.isActive !== false,\n    stepOrder: frontendData.stepOrder || 1,\n  }),\n\n  // 프로젝트 데이터 변환\n  project: (frontendData) => ({\n    name: frontendData.name,\n    description: frontendData.description || '',\n    tags: frontendData.tags || [],\n    aiRole: frontendData.aiRole || '',\n    aiInstructions: frontendData.aiInstructions || '',\n    targetAudience: frontendData.targetAudience || '일반독자',\n    outputFormat: frontendData.outputFormat || 'multiple',\n    styleGuidelines: frontendData.styleGuidelines || '',\n  }),\n};\n\n/**\n * 백엔드 → 프론트엔드 데이터 변환\n */\nconst mapBackendToFrontend = {\n  // 채팅 메시지 변환\n  chatMessage: (backendData) => ({\n    id: backendData.id || backendData.messageId || Date.now().toString(),\n    role: backendData.role,\n    content: backendData.content || backendData.text,\n    timestamp: backendData.timestamp || backendData.createdAt || new Date().toISOString(),\n    tokenCount: backendData.tokenCount || backendData.tokens_used,\n  }),\n\n  // 프롬프트 카드 변환\n  promptCard: (backendData) => ({\n    promptId: backendData.promptId || backendData.prompt_id,\n    title: backendData.title,\n    prompt_text: backendData.prompt_text || backendData.content,\n    tags: backendData.tags || [],\n    isActive: backendData.isActive !== false,\n    enabled: backendData.isActive !== false,\n    stepOrder: backendData.stepOrder || 1,\n    createdAt: backendData.createdAt,\n    updatedAt: backendData.updatedAt,\n  }),\n\n  // 프로젝트 변환\n  project: (backendData) => ({\n    projectId: backendData.projectId,\n    name: backendData.name,\n    description: backendData.description || '',\n    status: backendData.status,\n    tags: backendData.tags || [],\n    aiRole: backendData.aiRole || '',\n    aiInstructions: backendData.aiInstructions || '',\n    targetAudience: backendData.targetAudience || '일반독자',\n    outputFormat: backendData.outputFormat || 'multiple',\n    styleGuidelines: backendData.styleGuidelines || '',\n    createdAt: backendData.createdAt,\n    updatedAt: backendData.updatedAt,\n    promptCount: backendData.promptCount || 0,\n    conversationCount: backendData.conversationCount || 0,\n  }),\n\n  // 대화 목록 변환\n  conversation: (backendData) => ({\n    id: backendData.id || backendData.conversationId,\n    title: backendData.title,\n    startedAt: backendData.startedAt || backendData.createdAt,\n    lastActivityAt: backendData.lastActivityAt || backendData.updatedAt,\n    tokenSum: backendData.tokenSum || backendData.totalTokens || 0,\n  }),\n};\n\n/**\n * Mock 데이터와 실제 API 간 전환을 위한 플래그\n */\nconst USE_MOCK_DATA = process.env.REACT_APP_USE_MOCK_DATA === 'true';\n\n/**\n * 🔍 API 연결 상태 확인 함수\n */\nexport const testApiConnection = async () => {\n  console.log(\"🔍 API 연결 상태 확인 중...\");\n  console.log(\"- API Base URL:\", API_BASE_URL);\n  console.log(\"- Use Mock Data:\", USE_MOCK_DATA);\n  console.log(\"- Node Env:\", process.env.NODE_ENV);\n  \n  try {\n    // 간단한 헬스체크 엔드포인트 호출\n    const response = await api.get(\"/health\");\n    console.log(\"✅ API 연결 성공:\", response.status);\n    return { success: true, status: response.status, data: response.data };\n  } catch (error) {\n    console.log(\"❌ API 연결 실패:\", error.message);\n    console.log(\"- Status:\", error.response?.status);\n    console.log(\"- Error Code:\", error.code);\n    return { \n      success: false, \n      error: error.message, \n      status: error.response?.status,\n      code: error.code \n    };\n  }\n};\n\n// =============================================================================\n// 프로젝트 API (기존 유지)\n// =============================================================================\n\nexport const projectAPI = {\n  getProjects: async () => {\n    try {\n      const response = await api.get(\"/projects\");\n      // 백엔드 데이터를 프론트엔드 형식으로 변환\n      const projects = response.data.projects || response.data;\n      return {\n        projects: Array.isArray(projects) ? projects.map(mapBackendToFrontend.project) : [],\n        count: response.data.count || projects.length,\n        hasMore: response.data.hasMore || false,\n        nextKey: response.data.nextKey,\n      };\n    } catch (error) {\n      console.error(\"프로젝트 목록 조회 실패:\", error);\n      throw error;\n    }\n  },\n\n  getProject: async (projectId) => {\n    try {\n      const response = await api.get(`/projects/${projectId}`);\n      // 백엔드 데이터를 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.project(response.data);\n    } catch (error) {\n      console.error(\"프로젝트 상세 조회 실패:\", error);\n      throw error;\n    }\n  },\n\n  createProject: async (projectData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.project(projectData);\n      const response = await api.post(\"/projects\", backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.project(response.data);\n    } catch (error) {\n      console.error(\"프로젝트 생성 실패:\", error);\n      throw error;\n    }\n  },\n\n  updateProject: async (projectId, projectData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.project(projectData);\n      const response = await api.put(`/projects/${projectId}`, backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.project(response.data);\n    } catch (error) {\n      console.error(\"프로젝트 업데이트 실패:\", error);\n      throw error;\n    }\n  },\n\n  deleteProject: async (projectId) => {\n    try {\n      const response = await api.delete(`/projects/${projectId}`);\n      return response.data;\n    } catch (error) {\n      console.error(\"프로젝트 삭제 실패:\", error);\n      throw error;\n    }\n  },\n\n  getUploadUrl: async (projectId, fileName) => {\n    try {\n      const response = await api.get(`/projects/${projectId}/upload-url`, {\n        params: { fileName },\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"업로드 URL 생성 실패:\", error);\n      throw error;\n    }\n  },\n};\n\n// =============================================================================\n// 프롬프트 카드 API (기존 유지)\n// =============================================================================\n\nexport const promptCardAPI = {\n  getPromptCards: async (\n    projectId,\n    includeContent = false,\n    includeStats = false\n  ) => {\n    try {\n      const response = await api.get(`/prompts/${projectId}`, {\n        params: { includeContent, includeStats },\n      });\n      \n      // 백엔드 응답을 프론트엔드 형식으로 변환\n      const promptCards = response.data.promptCards || response.data.prompts || response.data;\n      return {\n        promptCards: Array.isArray(promptCards) ? promptCards.map(mapBackendToFrontend.promptCard) : [],\n        count: response.data.count || promptCards.length,\n      };\n    } catch (error) {\n      console.error(\"프롬프트 카드 목록 조회 실패:\", error);\n      throw error;\n    }\n  },\n\n  createPromptCard: async (projectId, promptData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.promptCard(promptData);\n      const response = await api.post(`/prompts/${projectId}`, backendData);\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.promptCard(response.data);\n    } catch (error) {\n      console.error(\"프롬프트 카드 생성 실패:\", error);\n      throw error;\n    }\n  },\n\n  updatePromptCard: async (projectId, promptId, promptData) => {\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.promptCard(promptData);\n      const response = await api.put(\n        `/prompts/${projectId}/${promptId}`,\n        backendData\n      );\n      // 응답을 프론트엔드 형식으로 변환\n      return mapBackendToFrontend.promptCard(response.data);\n    } catch (error) {\n      console.error(\"프롬프트 카드 업데이트 실패:\", error);\n      throw error;\n    }\n  },\n\n  getPromptContent: async (projectId, promptId) => {\n    try {\n      const response = await api.get(`/prompts/${projectId}/${promptId}/content`);\n      return response.data;\n    } catch (error) {\n      console.error(\"프롬프트 내용 조회 실패:\", error);\n      throw error;\n    }\n  },\n\n  deletePromptCard: async (projectId, promptId) => {\n    try {\n      const response = await api.delete(`/prompts/${projectId}/${promptId}`);\n      return response.data;\n    } catch (error) {\n      console.error(\"프롬프트 카드 삭제 실패:\", error);\n      throw error;\n    }\n  },\n\n  reorderPromptCards: async (projectId, reorderData) => {\n    try {\n      const updatePromises = reorderData.map(({ promptId, stepOrder }) =>\n        api.put(`/prompts/${projectId}/${promptId}`, { stepOrder })\n      );\n\n      const responses = await Promise.all(updatePromises);\n      return {\n        message: \"프롬프트 카드 순서가 업데이트되었습니다.\",\n        updatedCards: responses.map((r) => mapBackendToFrontend.promptCard(r.data)),\n      };\n    } catch (error) {\n      console.error(\"프롬프트 카드 순서 변경 실패:\", error);\n      throw error;\n    }\n  },\n};\n\n// =============================================================================\n// 🔧 완전 수정된 제목 생성 API\n// =============================================================================\n\nexport const generateAPI = {\n  generateTitle: async (projectId, data) => {\n    console.log(\"대화 생성 요청 시작:\", {\n      projectId,\n      inputLength: data.userInput?.length || 0,\n      historyLength: data.chat_history?.length || 0,\n      timestamp: new Date().toISOString(),\n    });\n\n    try {\n      // 프론트엔드 데이터를 백엔드 형식으로 변환\n      const backendData = mapFrontendToBackend.chatMessage(data);\n      \n      console.log(\"🔄 변환된 백엔드 데이터:\", backendData);\n      \n      const response = await api.post(`/projects/${projectId}/generate`, backendData);\n\n      console.log(\"대화 생성 성공:\", {\n        status: response.status,\n        mode: response.data.mode,\n        message: response.data.message,\n        timestamp: new Date().toISOString(),\n      });\n\n      return response.data;\n    } catch (error) {\n      console.error(\"대화 생성 실패:\", {\n        code: error.code,\n        message: error.message,\n        status: error.response?.status,\n        responseData: error.response?.data,\n        timestamp: new Date().toISOString(),\n      });\n      throw error;\n    }\n  },\n\n  // 🔧 실제 스트리밍 구현 - Server-Sent Events 사용\n  generateTitleStream: async (\n    projectId,\n    data,\n    onChunk,\n    onError,\n    onComplete\n  ) => {\n    console.log(\"스트리밍 대화 생성 요청 시작:\", {\n      projectId,\n      inputLength: data.userInput?.length || 0,\n      historyLength: data.chat_history?.length || 0,\n      timestamp: new Date().toISOString(),\n    });\n\n    // 프론트엔드 데이터를 백엔드 형식으로 변환 (try-catch 밖에서 정의)\n    const backendData = mapFrontendToBackend.chatMessage(data);\n    console.log(\"🔄 스트리밍용 변환된 데이터:\", backendData);\n\n    try {\n      // 1. 먼저 실제 스트리밍 API 시도\n      const streamingUrl = `${API_BASE_URL}/projects/${projectId}/generate/stream`;\n      \n      console.log(\"🚀 실제 스트리밍 API 시도:\", streamingUrl);\n\n      // 인증 토큰 가져오기\n      let authHeaders = {};\n      try {\n        const { fetchAuthSession } = await import('aws-amplify/auth');\n        const session = await fetchAuthSession();\n        const token = session?.tokens?.idToken?.toString();\n        if (token) {\n          authHeaders.Authorization = `Bearer ${token}`;\n        }\n      } catch (authError) {\n        console.log(\"인증 토큰 가져오기 실패:\", authError.message);\n      }\n\n      const response = await fetch(streamingUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'text/event-stream',\n          ...authHeaders, // 인증 토큰 포함\n        },\n        body: JSON.stringify(backendData), // 변환된 데이터 사용\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      // 2. 응답이 스트리밍 형식인지 확인\n      const contentType = response.headers.get('content-type');\n      if (!contentType || !contentType.includes('text/event-stream')) {\n        console.log(\"❌ 스트리밍 응답이 아님, 폴백 처리\");\n        throw new Error(\"스트리밍 응답이 아닙니다\");\n      }\n\n      // 3. 실제 스트리밍 처리\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n      let fullResponse = '';\n\n      try {\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) break;\n\n          buffer += decoder.decode(value, { stream: true });\n          const lines = buffer.split('\\n');\n          buffer = lines.pop() || '';\n\n          for (const line of lines) {\n            if (line.startsWith('data: ')) {\n              try {\n                const eventData = JSON.parse(line.slice(6));\n                \n                if (eventData.type === 'start') {\n                  console.log(\"✅ 스트리밍 시작\");\n                } else if (eventData.type === 'chunk') {\n                  fullResponse += eventData.response;\n                  if (onChunk) {\n                    onChunk(eventData.response, { content: eventData.response });\n                  }\n                } else if (eventData.type === 'complete') {\n                  console.log(\"✅ 스트리밍 완료\");\n                  if (onComplete) {\n                    onComplete({\n                      result: eventData.fullResponse || fullResponse,\n                      timestamp: new Date().toISOString(),\n                    });\n                  }\n                  return { result: eventData.fullResponse || fullResponse };\n                } else if (eventData.type === 'error') {\n                  throw new Error(eventData.error);\n                }\n              } catch (parseError) {\n                console.error(\"JSON 파싱 오류:\", parseError);\n              }\n            }\n          }\n        }\n      } finally {\n        reader.releaseLock();\n      }\n\n      return { result: fullResponse };\n\n    } catch (streamError) {\n      console.log(\"⚠️ 스트리밍 실패, 폴백 처리:\", streamError.message);\n      \n      // 4. 폴백: 일반 API 호출\n      try {\n        const fallbackResponse = await api.post(\n          `/projects/${projectId}/generate`,\n          backendData // 변환된 데이터 사용\n        );\n\n        console.log(\"✅ 폴백 API 성공:\", {\n          mode: fallbackResponse.data.mode,\n          timestamp: new Date().toISOString(),\n        });\n\n        // 폴백 응답을 스트리밍처럼 시뮬레이션\n        if (fallbackResponse.data.result && onChunk) {\n          const fullText = fallbackResponse.data.result;\n          const words = fullText.split(\" \");\n\n          for (let i = 0; i < words.length; i++) {\n            const word = words[i] + (i < words.length - 1 ? \" \" : \"\");\n            onChunk(word, { content: word });\n            await new Promise((resolve) => setTimeout(resolve, 30));\n          }\n        }\n\n        // 완료 콜백 호출\n        if (onComplete) {\n          onComplete({\n            result: fallbackResponse.data.result,\n            model_info: fallbackResponse.data.model_info,\n            performance_metrics: fallbackResponse.data.performance_metrics,\n            timestamp: new Date().toISOString(),\n          });\n        }\n\n        return fallbackResponse.data;\n      } catch (fallbackError) {\n        console.error(\"❌ 폴백 API도 실패:\", fallbackError);\n        if (onError) {\n          onError(\n            new Error(\"서비스에 연결할 수 없습니다. 잠시 후 다시 시도해주세요.\")\n          );\n        }\n        throw new Error(\"서비스를 사용할 수 없습니다.\");\n      }\n    }\n  },\n\n  getExecutionStatus: async (executionArn) => {\n    return {\n      status: \"SUCCEEDED\",\n      output: \"{}\",\n    };\n  },\n};\n\n// =============================================================================\n// 🆕 CrewAI 멀티-에이전트 API (새로 추가)\n// =============================================================================\n\nexport const crewAPI = {\n  // 프롬프트 인스턴스 생성 (프롬프트 카드들을 에이전트로 변환)\n  createCrewInstance: async (projectId, promptCards) => {\n    console.log(\"크루 인스턴스 생성 요청:\", { projectId, promptCardsCount: promptCards.length });\n    \n    const response = await api.post(\"/crew/instances\", {\n      projectId,\n      promptCards: promptCards.map(card => ({\n        promptId: card.promptId,\n        prompt_text: card.prompt_text,\n        stepOrder: card.stepOrder,\n        isActive: card.isActive\n      }))\n    });\n    \n    console.log(\"크루 인스턴스 생성 완료:\", response.data);\n    return response.data;\n  },\n\n  // 프로젝트의 크루 인스턴스 조회\n  getCrewInstances: async (projectId) => {\n    console.log(\"크루 인스턴스 조회:\", { projectId });\n    \n    const response = await api.get(`/crew/instances/${projectId}`);\n    return response.data;\n  },\n\n  // 크루 설정 조회\n  getCrewConfig: async (projectId) => {\n    console.log(\"크루 설정 조회:\", { projectId });\n    \n    const response = await api.get(`/crew/config/${projectId}`);\n    return response.data;\n  },\n\n  // 🌟 멀티-에이전트 병렬 실행 (핵심 기능)\n  executeMultiAgent: async (projectId, userInput, onProgress = null) => {\n    console.log(\"멀티-에이전트 실행 시작:\", { \n      projectId, \n      inputLength: userInput.length,\n      timestamp: new Date().toISOString()\n    });\n\n    try {\n      const response = await api.post(\"/crew/execute\", {\n        projectId,\n        userInput,\n        mode: \"parallel\" // 병렬 처리 모드 명시\n      });\n\n      console.log(\"멀티-에이전트 실행 완료:\", {\n        agentCount: Object.keys(response.data.agentResults || {}).length,\n        titleCount: Object.keys(response.data.finalTitles || {}).length,\n        tokenUsage: response.data.tokenUsage,\n        timestamp: new Date().toISOString()\n      });\n\n      return response.data;\n    } catch (error) {\n      console.error(\"멀티-에이전트 실행 실패:\", {\n        error: error.message,\n        status: error.response?.status,\n        data: error.response?.data,\n        timestamp: new Date().toISOString()\n      });\n      throw error;\n    }\n  },\n\n  // 에이전트별 상세 결과 조회\n  getAgentResults: async (projectId, executionId) => {\n    console.log(\"에이전트 결과 조회:\", { projectId, executionId });\n    \n    const response = await api.get(`/crew/results/${projectId}/${executionId}`);\n    return response.data;\n  }\n};\n\n// =============================================================================\n// 채팅 API (기존 유지)\n// =============================================================================\n\nexport const chatAPI = {\n  sendMessage: async (projectId, message, sessionId, userId = \"default\") => {\n    console.log(\"채팅 메시지를 generate API로 전달:\", {\n      projectId,\n      message,\n      sessionId,\n      userId,\n    });\n\n    try {\n      const response = await generateAPI.generateTitle(projectId, {\n        userInput: message,\n        userRequest: \"\",\n        chat_history: [],\n      });\n\n      return {\n        response: response.result,\n        sessionId,\n        userId,\n        timestamp: new Date().toISOString(),\n        mode: response.mode || \"chat\",\n      };\n    } catch (error) {\n      console.error(\"채팅 메시지 처리 실패:\", error);\n      throw error;\n    }\n  },\n\n  getChatHistory: async (projectId, sessionId, userId = \"default\") => {\n    console.log(\"채팅 히스토리 조회:\", { projectId, sessionId, userId });\n\n    return {\n      messages: [],\n      sessionId,\n      userId,\n      message:\n        \"채팅 히스토리는 현재 지원되지 않습니다. 각 메시지는 독립적으로 처리됩니다.\",\n    };\n  },\n\n  getChatSessions: async (projectId, userId = \"default\") => {\n    console.log(\"채팅 세션 목록 조회:\", { projectId, userId });\n\n    return {\n      sessions: [],\n      message:\n        \"채팅 세션은 현재 지원되지 않습니다. 각 대화는 독립적으로 처리됩니다.\",\n    };\n  },\n\n  deleteChatSession: async (projectId, sessionId, userId = \"default\") => {\n    console.log(\"채팅 세션 삭제:\", { projectId, sessionId, userId });\n\n    return {\n      message: \"채팅 세션 삭제가 완료되었습니다.\",\n      sessionId,\n      userId,\n    };\n  },\n};\n\n// =============================================================================\n// 인증 API (기존 유지)\n// =============================================================================\n\nexport const authAPI = {\n  isAuthenticated: () => {\n    return true;\n  },\n\n  getCurrentUser: () => {\n    return {\n      id: \"user\",\n      email: \"user@example.com\",\n      name: \"사용자\",\n    };\n  },\n\n  signin: async (credentials) => {\n    const response = await api.post(\"/auth/signin\", credentials);\n    return response.data;\n  },\n\n  signup: async (userData) => {\n    const response = await api.post(\"/auth/signup\", userData);\n    return response.data;\n  },\n\n  signout: async () => {\n    const response = await api.post(\"/auth/signout\");\n    return response.data;\n  },\n\n  verifyEmail: async (verificationData) => {\n    const response = await api.post(\"/auth/verify-email\", verificationData);\n    return response.data;\n  },\n\n  forgotPassword: async (email) => {\n    const response = await api.post(\"/auth/forgot-password\", { email });\n    return response.data;\n  },\n\n  confirmPassword: async (resetData) => {\n    const response = await api.post(\"/auth/confirm-password\", resetData);\n    return response.data;\n  },\n\n  // 비밀번호 찾기 - 인증번호 발송\n  requestPasswordReset: async (email) => {\n    const response = await api.post(\"/auth/forgot-password\", { email });\n    return response.data;\n  },\n\n  // 비밀번호 재설정 - 인증번호와 새 비밀번호로 재설정\n  resetPassword: async (resetData) => {\n    const response = await api.post(\"/auth/confirm-password\", {\n      email: resetData.email,\n      code: resetData.code,\n      newPassword: resetData.newPassword\n    });\n    return response.data;\n  },\n};\n\n// =============================================================================\n// 🔧 개선된 오류 처리 함수\n// =============================================================================\n\nexport const handleAPIError = async (error) => {\n  console.error(\"API 오류 상세 분석:\", {\n    message: error.message,\n    code: error.code,\n    status: error.response?.status,\n    statusText: error.response?.statusText,\n    data: error.response?.data,\n    timestamp: new Date().toISOString(),\n  });\n\n  // 401 Unauthorized 특별 처리 - 로그인 페이지로 리다이렉트\n  if (error.response?.status === 401) {\n    try {\n      // AuthContext에서 로그아웃 처리\n      const { signOut } = await import('aws-amplify/auth');\n      await signOut();\n      \n      // 로그인 페이지로 리다이렉트\n      window.location.href = '/auth/signin';\n      \n      return {\n        userMessage: \"인증이 만료되었습니다. 다시 로그인해주세요.\",\n        statusCode: 401,\n        errorType: \"UNAUTHORIZED\",\n        shouldRedirect: true,\n      };\n    } catch (signOutError) {\n      console.error(\"로그아웃 처리 실패:\", signOutError);\n      // 로그아웃 실패해도 리다이렉트\n      window.location.href = '/auth/signin';\n      return {\n        userMessage: \"인증이 만료되었습니다. 다시 로그인해주세요.\",\n        statusCode: 401,\n        errorType: \"UNAUTHORIZED\",\n        shouldRedirect: true,\n      };\n    }\n  }\n\n  // 403 Forbidden 특별 처리\n  if (error.response?.status === 403) {\n    return {\n      userMessage: \"API 접근이 차단되었습니다. 관리자에게 문의하세요.\",\n      statusCode: 403,\n      errorType: \"FORBIDDEN\",\n      shouldRedirect: false,\n    };\n  }\n\n  // Gateway Timeout 특별 처리\n  if (error.response?.status === 504) {\n    return {\n      userMessage:\n        \"서버 응답 시간이 초과되었습니다. 요청을 간소화하거나 잠시 후 다시 시도해주세요.\",\n      statusCode: 504,\n      errorType: \"GATEWAY_TIMEOUT\",\n      shouldRedirect: false,\n    };\n  }\n\n  // CORS 오류 특별 처리\n  if (\n    error.message?.includes(\"CORS\") ||\n    error.code === \"ERR_NETWORK\" ||\n    error.message?.includes(\"Access-Control-Allow-Origin\")\n  ) {\n    return {\n      userMessage:\n        \"서버 연결 설정에 문제가 있습니다. 페이지를 새로고침하고 다시 시도해주세요.\",\n      statusCode: 0,\n      errorType: \"CORS_ERROR\",\n      shouldRedirect: false,\n    };\n  }\n\n  // 타임아웃 오류 특별 처리\n  if (error.code === \"ECONNABORTED\") {\n    return {\n      userMessage:\n        \"요청 처리 시간이 초과되었습니다. 입력을 줄이거나 잠시 후 다시 시도해주세요.\",\n      statusCode: 0,\n      errorType: \"TIMEOUT_ERROR\",\n      shouldRedirect: false,\n    };\n  }\n\n  if (error.response) {\n    const status = error.response.status;\n    const message =\n      error.response.data?.message ||\n      error.response.data?.error ||\n      \"서버 오류가 발생했습니다\";\n\n    switch (status) {\n      case 400:\n        return { \n          userMessage: `잘못된 요청: ${message}`, \n          statusCode: 400,\n          shouldRedirect: false,\n        };\n      case 404:\n        return { \n          userMessage: \"요청한 리소스를 찾을 수 없습니다\", \n          statusCode: 404,\n          shouldRedirect: false,\n        };\n      case 429:\n        return {\n          userMessage: \"요청이 너무 많습니다. 잠시 후 다시 시도해주세요\",\n          statusCode: 429,\n          shouldRedirect: false,\n        };\n      case 500:\n        return { \n          userMessage: \"서버 내부 오류가 발생했습니다\", \n          statusCode: 500,\n          shouldRedirect: false,\n        };\n      default:\n        return {\n          userMessage: `서버 오류 (${status}): ${message}`,\n          statusCode: status,\n          shouldRedirect: false,\n        };\n    }\n  } else if (error.request) {\n    return {\n      userMessage: \"서버에 연결할 수 없습니다. 네트워크 연결을 확인해주세요\",\n      statusCode: 0,\n      errorType: \"NETWORK_ERROR\",\n      shouldRedirect: false,\n    };\n  } else {\n    return {\n      userMessage: `요청 오류: ${error.message}`,\n      statusCode: -1,\n      errorType: \"REQUEST_ERROR\",\n      shouldRedirect: false,\n    };\n  }\n};\n\n// =============================================================================\n// 기타 유틸리티 함수들 (기존 유지)\n// =============================================================================\n\nexport const DYNAMIC_PROMPT_SYSTEM = {\n  message:\n    \"원하는 만큼 프롬프트 카드를 생성하여 나만의 AI 어시스턴트를 만들어보세요!\",\n  maxPromptCards: 50,\n  supportedFormats: [\"text\", \"markdown\"],\n  defaultStepOrder: 1,\n};\n\nexport const COLOR_OPTIONS = [\n  {\n    id: \"blue\",\n    name: \"파랑\",\n    bgClass: \"bg-blue-100\",\n    textClass: \"text-blue-800\",\n    borderClass: \"border-blue-200\",\n  },\n  {\n    id: \"green\",\n    name: \"초록\",\n    bgClass: \"bg-green-100\",\n    textClass: \"text-green-800\",\n    borderClass: \"border-green-200\",\n  },\n  {\n    id: \"purple\",\n    name: \"보라\",\n    bgClass: \"bg-purple-100\",\n    textClass: \"text-purple-800\",\n    borderClass: \"border-purple-200\",\n  },\n  {\n    id: \"orange\",\n    name: \"주황\",\n    bgClass: \"bg-orange-100\",\n    textClass: \"text-orange-800\",\n    borderClass: \"border-orange-200\",\n  },\n  {\n    id: \"red\",\n    name: \"빨강\",\n    bgClass: \"bg-red-100\",\n    textClass: \"text-red-800\",\n    borderClass: \"border-red-200\",\n  },\n  {\n    id: \"indigo\",\n    name: \"남색\",\n    bgClass: \"bg-indigo-100\",\n    textClass: \"text-indigo-800\",\n    borderClass: \"border-indigo-200\",\n  },\n  {\n    id: \"pink\",\n    name: \"분홍\",\n    bgClass: \"bg-pink-100\",\n    textClass: \"text-pink-800\",\n    borderClass: \"border-pink-200\",\n  },\n  {\n    id: \"yellow\",\n    name: \"노랑\",\n    bgClass: \"bg-yellow-100\",\n    textClass: \"text-yellow-800\",\n    borderClass: \"border-yellow-200\",\n  },\n  {\n    id: \"gray\",\n    name: \"회색\",\n    bgClass: \"bg-gray-100\",\n    textClass: \"text-gray-800\",\n    borderClass: \"border-gray-200\",\n  },\n];\n\nexport const getPromptCardInfo = (promptCard) => {\n  return {\n    id: promptCard.promptId || promptCard.id,\n    title: promptCard.title || \"새 프롬프트 카드\",\n    color: promptCard.color || \"gray\",\n    description: promptCard.description || \"\",\n    stepOrder: promptCard.stepOrder || 1,\n    isActive: promptCard.isActive !== false,\n  };\n};\n\nexport const filterProjects = (projects, filters) => {\n  let filtered = [...projects];\n\n  if (filters.searchQuery) {\n    const query = filters.searchQuery.toLowerCase();\n    filtered = filtered.filter(\n      (project) =>\n        project.name?.toLowerCase().includes(query) ||\n        project.description?.toLowerCase().includes(query) ||\n        project.tags?.some((tag) => tag.toLowerCase().includes(query))\n    );\n  }\n\n  switch (filters.sortBy) {\n    case \"created\":\n      filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n      break;\n    case \"updated\":\n      filtered.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n      break;\n    case \"name\":\n      filtered.sort((a, b) => a.name?.localeCompare(b.name));\n      break;\n    default:\n      break;\n  }\n\n  return filtered;\n};\n\nexport const formatTokenCount = (count) => {\n  if (count >= 1000) {\n    return `${(count / 1000).toFixed(1)}K`;\n  }\n  return count.toString();\n};\n\nexport const formatFileSize = (bytes) => {\n  if (bytes >= 1024) {\n    return `${(bytes / 1024).toFixed(1)}KB`;\n  }\n  return `${bytes}B`;\n};\n\nexport const calculatePromptStats = (promptCards) => {\n  if (!promptCards || promptCards.length === 0) {\n    return {\n      totalCards: 0,\n      totalTokens: 0,\n      averageTokens: 0,\n      activeCards: 0,\n      maxStepOrder: 0,\n      hasCustomOrder: false,\n    };\n  }\n\n  const activeCards = promptCards.filter((card) => card.isActive !== false);\n  const totalTokens = activeCards.reduce((sum, card) => {\n    return sum + (card.tokenCount || card.contentLength || 0);\n  }, 0);\n\n  const stepOrders = activeCards\n    .map((card) => card.stepOrder || 0)\n    .filter((step) => step > 0);\n  const hasCustomOrder = stepOrders.length > 0;\n  const maxStepOrder = stepOrders.length > 0 ? Math.max(...stepOrders) : 0;\n\n  return {\n    totalCards: promptCards.length,\n    activeCards: activeCards.length,\n    totalTokens,\n    averageTokens:\n      activeCards.length > 0 ? Math.round(totalTokens / activeCards.length) : 0,\n    maxStepOrder,\n    hasCustomOrder,\n    stepOrderRange: {\n      min: stepOrders.length > 0 ? Math.min(...stepOrders) : 0,\n      max: maxStepOrder,\n    },\n  };\n};\n\n// =============================================================================\n// Usage API (Dashboard용)\n// =============================================================================\n\nexport const getUsage = async (range = 'month') => {\n  console.log(\"사용량 데이터 조회 요청:\", { range });\n  \n  // Mock 데이터 사용 모드이거나 개발 모드일 때\n  if (USE_MOCK_DATA || process.env.NODE_ENV === 'development') {\n    console.log(\"🔄 Mock 사용량 데이터 반환\");\n    // Simulate API delay\n    await new Promise(resolve => setTimeout(resolve, 500));\n    return mockUsageData;\n  }\n  \n  try {\n    const response = await api.get(`/usage?range=${range}`);\n    console.log(\"✅ 사용량 API 호출 성공\");\n    return response.data;\n  } catch (error) {\n    console.warn(\"⚠️ 사용량 API 호출 실패, Mock 데이터로 폴백:\", error.message);\n    // Fallback to mock data\n    return mockUsageData;\n  }\n};\n\n// =============================================================================\n// 🆕 Conversation History API\n// =============================================================================\n\nexport const conversationAPI = {\n  // 대화 목록 조회 (무한 스크롤)\n  getConversations: async (cursor, limit = 20) => {\n    console.log(\"대화 목록 조회 시작:\", { cursor, limit, API_BASE_URL });\n    \n    const params = new URLSearchParams({ limit: limit.toString() });\n    if (cursor) {\n      params.append('cursor', cursor);\n    }\n    \n    const url = `/conversations?${params}`;\n    console.log(\"API 요청 URL:\", `${API_BASE_URL}${url}`);\n    \n    try {\n      const response = await api.get(url);\n      console.log(\"대화 목록 조회 성공:\", response.data);\n      \n      // 백엔드 응답을 프론트엔드 형식으로 변환\n      const conversations = response.data.conversations || response.data.items || response.data;\n      return {\n        conversations: Array.isArray(conversations) ? conversations.map(mapBackendToFrontend.conversation) : [],\n        hasMore: response.data.hasMore || false,\n        nextCursor: response.data.nextCursor || response.data.cursor,\n      };\n    } catch (error) {\n      console.error(\"대화 목록 조회 실패:\", error);\n      // Mock 데이터로 폴백 (개발 시)\n      if (USE_MOCK_DATA || process.env.NODE_ENV === 'development') {\n        console.log(\"🔄 Mock 데이터로 폴백\");\n        return {\n          conversations: mockConversations,\n          hasMore: false,\n          nextCursor: null,\n        };\n      }\n      throw error;\n    }\n  },\n\n  // 새 대화 생성\n  createConversation: async (title = 'New Conversation') => {\n    console.log(\"새 대화 생성:\", { title });\n    \n    try {\n      const response = await api.post('/conversations', { title });\n      return response.data;\n    } catch (error) {\n      console.error(\"대화 생성 실패:\", error);\n      throw error;\n    }\n  },\n\n  // 특정 대화의 메시지 조회 (페이징)\n  getMessages: async (conversationId, cursor, limit = 50) => {\n    console.log(\"메시지 조회:\", { conversationId, cursor, limit });\n    \n    const params = new URLSearchParams({ \n      convId: conversationId,\n      limit: limit.toString() \n    });\n    if (cursor) {\n      params.append('cursor', cursor);\n    }\n    \n    try {\n      const response = await api.get(`/messages?${params}`);\n      \n      // 백엔드 응답을 프론트엔드 형식으로 변환\n      const messages = response.data.messages || response.data.items || response.data;\n      return {\n        messages: Array.isArray(messages) ? messages.map(mapBackendToFrontend.chatMessage) : [],\n        hasMore: response.data.hasMore || false,\n        nextCursor: response.data.nextCursor || response.data.cursor,\n      };\n    } catch (error) {\n      console.error(\"메시지 조회 실패:\", error);\n      // Mock 데이터로 폴백 (개발 시)\n      if (USE_MOCK_DATA || process.env.NODE_ENV === 'development') {\n        console.log(\"🔄 Mock 메시지 데이터로 폴백\");\n        const mockMessageData = mockMessages[conversationId] || [];\n        return {\n          messages: mockMessageData,\n          hasMore: false,\n          nextCursor: null,\n        };\n      }\n      throw error;\n    }\n  },\n\n  // 대화 삭제\n  deleteConversation: async (conversationId) => {\n    console.log(\"대화 삭제:\", { conversationId });\n    \n    try {\n      const response = await api.delete(`/conversations/${conversationId}`);\n      console.log(\"대화 삭제 성공:\", response.data);\n      return response.data;\n    } catch (error) {\n      console.error(\"대화 삭제 실패:\", error);\n      throw error;\n    }\n  }\n};\n\n// Mock data for conversation development\nexport const mockConversations = [\n  {\n    id: '1',\n    title: '서울경제신문 AI 제목 생성 테스트',\n    startedAt: '2025-01-20T10:30:00Z',\n    lastActivityAt: '2025-01-20T15:45:00Z',\n    tokenSum: 1250\n  },\n  {\n    id: '2', \n    title: '경제 뉴스 헤드라인 최적화',\n    startedAt: '2025-01-19T14:20:00Z',\n    lastActivityAt: '2025-01-19T16:30:00Z',\n    tokenSum: 890\n  },\n  {\n    id: '3',\n    title: '부동산 시장 분석 제목 생성',\n    startedAt: '2025-01-18T09:15:00Z',\n    lastActivityAt: '2025-01-18T11:45:00Z',\n    tokenSum: 2150\n  }\n];\n\nexport const mockMessages = {\n  '1': [\n    {\n      id: '2025-01-20T10:30:00.000Z',\n      role: 'user',\n      content: '오늘 서울 부동산 시장 현황에 대한 기사 제목을 만들어주세요.',\n      tokenCount: 25,\n      timestamp: '2025-01-20T10:30:00.000Z'\n    },\n    {\n      id: '2025-01-20T10:30:05.000Z',\n      role: 'assistant', \n      content: '서울 부동산 시장 현황에 대한 몇 가지 제목 옵션을 제안해드리겠습니다:\\n\\n1. \"서울 아파트값 3개월 연속 하락세... 매수심리 위축\"\\n2. \"강남·서초구 고가 아파트 거래 급감, 시장 관망세 지속\"\\n3. \"서울 부동산 시장 \\'관망론\\' 확산... 전세시장은 여전히 불안\"',\n      tokenCount: 95,\n      timestamp: '2025-01-20T10:30:05.000Z'\n    }\n  ],\n  '2': [\n    {\n      id: '2025-01-19T14:20:00.000Z',\n      role: 'user',\n      content: '반도체 산업 관련 경제 뉴스 제목을 생성해주세요.',\n      tokenCount: 20,\n      timestamp: '2025-01-19T14:20:00.000Z'\n    },\n    {\n      id: '2025-01-19T14:20:03.000Z',\n      role: 'assistant',\n      content: '반도체 산업 관련 경제 뉴스 제목들을 제안드립니다:\\n\\n1. \"삼성전자 메모리 반도체 수요 회복 기대감... 주가 상승세\"\\n2. \"AI 칩 수요 급증에 SK하이닉스 4분기 실적 개선 전망\"\\n3. \"중국 반도체 굴기 vs 한국 기술력... 글로벌 경쟁 심화\"',\n      tokenCount: 78,\n      timestamp: '2025-01-19T14:20:03.000Z'\n    }\n  ]\n};\n\n// =============================================================================\n// 🧪 연결 테스트 및 상태 확인 함수들\n// =============================================================================\n\n/**\n * 🧪 REST API 연결 테스트 함수\n */\nexport const testAPIConnection = async () => {\n  try {\n    console.log(\"🔍 API 연결 테스트 시작...\");\n    \n    const response = await api.get(\"/health\", {\n      timeout: 5000, // 5초 타임아웃\n    });\n    \n    console.log(\"✅ API 연결 테스트 성공:\", response.data);\n    return {\n      success: true,\n      message: \"백엔드 서버 연결 성공\",\n      data: response.data,\n    };\n  } catch (error) {\n    console.error(\"❌ API 연결 테스트 실패:\", error);\n    \n    let errorMessage = \"백엔드 서버 연결 실패\";\n    if (error.code === \"ECONNABORTED\") {\n      errorMessage = \"연결 시간 초과 - 서버가 응답하지 않습니다\";\n    } else if (error.response?.status === 404) {\n      errorMessage = \"health 엔드포인트가 존재하지 않습니다\";\n    } else if (error.response?.status >= 500) {\n      errorMessage = \"서버 내부 오류가 발생했습니다\";\n    } else if (!error.response) {\n      errorMessage = \"네트워크 연결 오류 - 서버에 도달할 수 없습니다\";\n    }\n    \n    return {\n      success: false,\n      message: errorMessage,\n      error: error.message,\n      status: error.response?.status,\n    };\n  }\n};\n\n/**\n * 🔄 종합 연결 상태 확인 (REST API + WebSocket)\n */\nexport const checkConnectionStatus = async () => {\n  console.log(\"🔍 종합 연결 상태 확인 시작...\");\n  \n  const results = {\n    timestamp: new Date().toISOString(),\n    restApi: null,\n    websocket: null,\n    authentication: null,\n  };\n  \n  // 1. REST API 연결 테스트\n  try {\n    results.restApi = await testAPIConnection();\n  } catch (error) {\n    results.restApi = {\n      success: false,\n      message: \"REST API 테스트 중 오류 발생\",\n      error: error.message,\n    };\n  }\n  \n  // 2. 인증 상태 확인\n  try {\n    const { fetchAuthSession } = await import('aws-amplify/auth');\n    const session = await fetchAuthSession();\n    const token = session?.tokens?.idToken?.toString();\n    \n    results.authentication = {\n      success: !!token,\n      message: token ? \"인증 토큰 확인됨\" : \"인증 토큰 없음\",\n      hasToken: !!token,\n    };\n  } catch (error) {\n    results.authentication = {\n      success: false,\n      message: \"인증 상태 확인 실패\",\n      error: error.message,\n    };\n  }\n  \n  // 3. WebSocket URL 확인\n  try {\n    const wsUrl = process.env.REACT_APP_WS_URL;\n    results.websocket = {\n      success: !!wsUrl && (wsUrl.startsWith('wss://') || wsUrl.startsWith('ws://')),\n      message: !!wsUrl ? \"WebSocket URL 설정됨\" : \"WebSocket URL 미설정\",\n      url: wsUrl ? wsUrl.replace(/token=[^&]+/, 'token=***') : null,\n    };\n  } catch (error) {\n    results.websocket = {\n      success: false,\n      message: \"WebSocket 설정 확인 실패\",\n      error: error.message,\n    };\n  }\n  \n  console.log(\"📊 종합 연결 상태 결과:\", results);\n  return results;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}