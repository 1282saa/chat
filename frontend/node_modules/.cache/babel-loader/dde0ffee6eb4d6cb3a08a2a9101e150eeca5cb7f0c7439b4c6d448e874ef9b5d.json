{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useRef, useCallback } from \"react\";\n\n/**\n * WebSocket Ïã§ÏãúÍ∞Ñ Ïä§Ìä∏Î¶¨Î∞çÏùÑ ÏúÑÌïú Ïª§Ïä§ÌÖÄ ÌõÖ\n */\nexport const useWebSocket = projectId => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState(null);\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // WebSocket URL (ÌôòÍ≤ΩÎ≥ÄÏàòÎÇò Ïã§Ï†ú Î∞∞Ìè¨Îêú URLÎ°ú ÏÑ§Ï†ï)\n  const getWebSocketUrl = useCallback(() => {\n    const wsUrl = process.env.REACT_APP_WS_URL || \"wss://na17isxiri.execute-api.us-east-1.amazonaws.com/prod\";\n\n    // URL ÌòïÏãù Í≤ÄÏ¶ù Î∞è Ï†ïÍ∑úÌôî\n    if (!wsUrl.startsWith(\"wss://\") && !wsUrl.startsWith(\"ws://\")) {\n      console.error(\"ÏûòÎ™ªÎêú WebSocket URL ÌòïÏãù:\", wsUrl);\n      return null;\n    }\n\n    // ÎÅùÏóê Ïä¨ÎûòÏãú Ï†úÍ±∞\n    const normalizedUrl = wsUrl.replace(/\\/$/, \"\");\n    console.log(\"WebSocket URL ÌôïÏù∏:\", normalizedUrl);\n    console.log(\"ÌôòÍ≤ΩÎ≥ÄÏàò REACT_APP_WS_URL:\", process.env.REACT_APP_WS_URL);\n    return normalizedUrl;\n  }, []);\n\n  // WebSocket Ïó∞Í≤∞\n  const connect = useCallback(() => {\n    var _wsRef$current, _wsRef$current2;\n    // Ïù¥ÎØ∏ Ïó∞Í≤∞ Ï§ëÏù¥Í±∞ÎÇò Ïó∞Í≤∞Îêú Í≤ΩÏö∞ Ï§ëÎ≥µ Ïó∞Í≤∞ Î∞©ÏßÄ\n    if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN || ((_wsRef$current2 = wsRef.current) === null || _wsRef$current2 === void 0 ? void 0 : _wsRef$current2.readyState) === WebSocket.CONNECTING) {\n      console.log(\"Ïù¥ÎØ∏ Ïó∞Í≤∞Îêú WebSocketÏù¥ ÏûàÏäµÎãàÎã§ (readyState:\", wsRef.current.readyState, \")\");\n      return;\n    }\n\n    // Ïù¥Ï†Ñ Ïó∞Í≤∞Ïù¥ ÏûàÎã§Î©¥ Ï†ïÎ¶¨\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n    setIsConnecting(true);\n    setError(null);\n    try {\n      const wsUrl = getWebSocketUrl();\n      if (!wsUrl) {\n        setError(\"Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ WebSocket URL\");\n        setIsConnecting(false);\n        return;\n      }\n      console.log(\"WebSocket Ïó∞Í≤∞ ÏãúÎèÑ:\", wsUrl);\n      console.log(\"Î∏åÎùºÏö∞Ï†Ä WebSocket ÏßÄÏõê:\", !!window.WebSocket);\n\n      // Ïó∞Í≤∞ ÏãúÎèÑ ÏãúÍ∞Ñ Í∏∞Î°ù\n      window.wsConnectStart = Date.now();\n      wsRef.current = new WebSocket(wsUrl);\n\n      // Ïó∞Í≤∞ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ\n      const connectionTimeout = setTimeout(() => {\n        var _wsRef$current3;\n        if (((_wsRef$current3 = wsRef.current) === null || _wsRef$current3 === void 0 ? void 0 : _wsRef$current3.readyState) === WebSocket.CONNECTING) {\n          console.error(\"WebSocket Ïó∞Í≤∞ ÏãúÍ∞Ñ Ï¥àÍ≥º\");\n          wsRef.current.close();\n          setError(\"Ïó∞Í≤∞ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§\");\n          setIsConnecting(false);\n        }\n      }, 10000); // 10Ï¥à ÌÉÄÏûÑÏïÑÏõÉ\n\n      wsRef.current.onopen = event => {\n        var _wsRef$current4, _wsRef$current5, _wsRef$current6;\n        clearTimeout(connectionTimeout);\n        console.log(\"üü¢ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ!\");\n        console.log(\"- Event:\", event);\n        console.log(\"- URL:\", (_wsRef$current4 = wsRef.current) === null || _wsRef$current4 === void 0 ? void 0 : _wsRef$current4.url);\n        console.log(\"- Protocol:\", (_wsRef$current5 = wsRef.current) === null || _wsRef$current5 === void 0 ? void 0 : _wsRef$current5.protocol);\n        console.log(\"- Extensions:\", (_wsRef$current6 = wsRef.current) === null || _wsRef$current6 === void 0 ? void 0 : _wsRef$current6.extensions);\n        setIsConnected(true);\n        setIsConnecting(false);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n      wsRef.current.onclose = event => {\n        clearTimeout(connectionTimeout);\n        const connectionDuration = Date.now() - (window.wsConnectStart || 0);\n        console.log(\"üî¥ WebSocket Ïó∞Í≤∞ Ï¢ÖÎ£å:\");\n        console.log(\"- Code:\", event.code);\n        console.log(\"- Reason:\", event.reason || \"(no reason provided)\");\n        console.log(\"- WasClean:\", event.wasClean);\n        console.log(\"- Connection duration:\", connectionDuration + \"ms\");\n        setIsConnected(false);\n        setIsConnecting(false);\n\n        // Ï¶âÏãú Ï¢ÖÎ£åÎêú Í≤ΩÏö∞ (500ms Ïù¥ÎÇ¥) - ÏÑúÎ≤Ñ Î¨∏Ï†ú\n        if (connectionDuration < 500) {\n          console.error(\"‚ö†Ô∏è WebSocketÏù¥ Ï¶âÏãú Ï¢ÖÎ£åÎê® - ÏÑúÎ≤Ñ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±\");\n\n          // ÌäπÏ†ï ÏóêÎü¨ ÏΩîÎìúÏóê Îî∞Î•∏ ÏÑ∏Î∂ÑÌôîÎêú ÏóêÎü¨ Î©îÏãúÏßÄ\n          let errorMessage = \"ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\";\n          switch (event.code) {\n            case 1006:\n              errorMessage = \"ÎπÑÏ†ïÏÉÅÏ†ÅÏù∏ Ïó∞Í≤∞ Ï¢ÖÎ£å (ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±)\";\n              break;\n            case 1002:\n              errorMessage = \"ÌîÑÎ°úÌÜ†ÏΩú Ïò§Î•ò\";\n              break;\n            case 1003:\n              errorMessage = \"ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ\";\n              break;\n            case 1011:\n              errorMessage = \"ÏÑúÎ≤Ñ ÎÇ¥Î∂Ä Ïò§Î•ò\";\n              break;\n          }\n          setError(errorMessage);\n          return;\n        }\n\n        // ÏûêÎèô Ïû¨Ïó∞Í≤∞ (Ï†ïÏÉÅ Ï¢ÖÎ£åÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞)\n        if (event.code !== 1000 && reconnectAttempts.current < maxReconnectAttempts) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 30000);\n          console.log(`üîÑ ${delay}ms ÌõÑ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ (${reconnectAttempts.current + 1}/${maxReconnectAttempts})`);\n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttempts.current++;\n            connect();\n          }, delay);\n        } else if (reconnectAttempts.current >= maxReconnectAttempts) {\n          setError(\"ÏµúÎåÄ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ÌöüÏàòÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§.\");\n        }\n      };\n      wsRef.current.onerror = error => {\n        var _wsRef$current7, _wsRef$current8;\n        clearTimeout(connectionTimeout);\n        console.error(\"üí• WebSocket Ïò§Î•ò:\", error);\n        console.log(\"- ReadyState:\", (_wsRef$current7 = wsRef.current) === null || _wsRef$current7 === void 0 ? void 0 : _wsRef$current7.readyState);\n        console.log(\"- URL:\", (_wsRef$current8 = wsRef.current) === null || _wsRef$current8 === void 0 ? void 0 : _wsRef$current8.url);\n        setError(\"WebSocket Ïó∞Í≤∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§\");\n        setIsConnecting(false);\n      };\n    } catch (err) {\n      console.error(\"üí• WebSocket ÏÉùÏÑ± Ïã§Ìå®:\", err);\n      setError(\"WebSocket Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: \" + err.message);\n      setIsConnecting(false);\n    }\n  }, [getWebSocketUrl]);\n\n  // WebSocket Ïó∞Í≤∞ Ìï¥Ï†ú\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = null;\n    }\n    if (wsRef.current) {\n      wsRef.current.close(1000, \"Manual disconnect\");\n      wsRef.current = null;\n    }\n    setIsConnected(false);\n    setIsConnecting(false);\n    reconnectAttempts.current = 0;\n  }, []);\n\n  // Î©îÏãúÏßÄ Ï†ÑÏÜ°\n  const sendMessage = useCallback(message => {\n    var _wsRef$current9;\n    if (((_wsRef$current9 = wsRef.current) === null || _wsRef$current9 === void 0 ? void 0 : _wsRef$current9.readyState) === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n      return true;\n    } else {\n      console.error(\"WebSocketÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§\");\n      setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");\n      return false;\n    }\n  }, []);\n\n  // Ïä§Ìä∏Î¶¨Î∞ç ÏöîÏ≤≠\n  const startStreaming = useCallback((userInput, chatHistory = []) => {\n    if (!isConnected) {\n      setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");\n      return false;\n    }\n    const message = {\n      action: \"stream\",\n      projectId,\n      userInput,\n      chat_history: chatHistory\n    };\n    return sendMessage(message);\n  }, [isConnected, projectId, sendMessage]);\n\n  // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Îì±Î°ù\n  const addMessageListener = useCallback(listener => {\n    if (wsRef.current) {\n      wsRef.current.addEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Ï†úÍ±∞\n  const removeMessageListener = useCallback(listener => {\n    if (wsRef.current) {\n      wsRef.current.removeEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏ Ïãú Ïó∞Í≤∞, Ïñ∏ÎßàÏö¥Ìä∏ Ïãú Ìï¥Ï†ú\n  useEffect(() => {\n    // Ï¥àÍ∏∞ Ïó∞Í≤∞ ÏßÄÏó∞ÏùÑ ÌÜµÌï¥ React strict mode Ïù¥Ïäà ÌöåÌîº\n    const timer = setTimeout(() => {\n      connect();\n    }, 100);\n    return () => {\n      clearTimeout(timer);\n      disconnect();\n    };\n  }, []); // ÏùòÏ°¥ÏÑ± Î∞∞Ïó¥ÏùÑ Îπà Î∞∞Ïó¥Î°ú Î≥ÄÍ≤Ω\n\n  // projectId Î≥ÄÍ≤Ω Ïãú Ïû¨Ïó∞Í≤∞\n  useEffect(() => {\n    if (isConnected && projectId) {\n      console.log('ProjectId Î≥ÄÍ≤ΩÎê®, Ïû¨Ïó∞Í≤∞ Ï§ë:', projectId);\n      disconnect();\n      setTimeout(connect, 200);\n    }\n  }, [projectId]); // connect, disconnect ÏùòÏ°¥ÏÑ± Ï†úÍ±∞\n\n  return {\n    isConnected,\n    isConnecting,\n    error,\n    connect,\n    disconnect,\n    sendMessage,\n    startStreaming,\n    addMessageListener,\n    removeMessageListener\n  };\n};\n_s(useWebSocket, \"VEvFLvd1lfAENuW3bGY3DDszaKQ=\");","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","useWebSocket","projectId","_s","isConnected","setIsConnected","isConnecting","setIsConnecting","error","setError","wsRef","reconnectTimeoutRef","reconnectAttempts","maxReconnectAttempts","getWebSocketUrl","wsUrl","process","env","REACT_APP_WS_URL","startsWith","console","normalizedUrl","replace","log","connect","_wsRef$current","_wsRef$current2","current","readyState","WebSocket","OPEN","CONNECTING","close","window","wsConnectStart","Date","now","connectionTimeout","setTimeout","_wsRef$current3","onopen","event","_wsRef$current4","_wsRef$current5","_wsRef$current6","clearTimeout","url","protocol","extensions","onclose","connectionDuration","code","reason","wasClean","errorMessage","delay","Math","min","pow","onerror","_wsRef$current7","_wsRef$current8","err","message","disconnect","sendMessage","_wsRef$current9","send","JSON","stringify","startStreaming","userInput","chatHistory","action","chat_history","addMessageListener","listener","addEventListener","removeMessageListener","removeEventListener","timer"],"sources":["/Users/yeong-gwang/Documents/work/·Ñâ·Ö•·Ñã·ÖÆ·ÜØ·ÑÄ·Öß·Üº·Ñå·Ö¶·Ñâ·Öµ·Ü´·ÑÜ·ÖÆ·Ü´/ai_·Ñå·Ö¶·ÑÜ·Ö©·Ü®·ÑÉ·Ö°·ÜØ·ÑÄ·Öµ(·Ñâ·ÖÆ)_·Ñã·Ö™·Ü´·Ñâ·Ö•·Üº·Ñá·Ö©·Ü´_·Ñâ·Ö≥·Ñê·Ö≥·ÑÖ·Öµ·ÑÜ·Öµ·Üº·ÑÄ·ÖÆ·Ñí·Öß·Ü´ ·Ñá·Ö©·Ü®·Ñâ·Ö°·Ñá·Ö©·Ü´/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from \"react\";\n\n/**\n * WebSocket Ïã§ÏãúÍ∞Ñ Ïä§Ìä∏Î¶¨Î∞çÏùÑ ÏúÑÌïú Ïª§Ïä§ÌÖÄ ÌõÖ\n */\nexport const useWebSocket = (projectId) => {\n  const [isConnected, setIsConnected] = useState(false);\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState(null);\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // WebSocket URL (ÌôòÍ≤ΩÎ≥ÄÏàòÎÇò Ïã§Ï†ú Î∞∞Ìè¨Îêú URLÎ°ú ÏÑ§Ï†ï)\n  const getWebSocketUrl = useCallback(() => {\n    const wsUrl =\n      process.env.REACT_APP_WS_URL ||\n      \"wss://na17isxiri.execute-api.us-east-1.amazonaws.com/prod\";\n    \n    // URL ÌòïÏãù Í≤ÄÏ¶ù Î∞è Ï†ïÍ∑úÌôî\n    if (!wsUrl.startsWith(\"wss://\") && !wsUrl.startsWith(\"ws://\")) {\n      console.error(\"ÏûòÎ™ªÎêú WebSocket URL ÌòïÏãù:\", wsUrl);\n      return null;\n    }\n    \n    // ÎÅùÏóê Ïä¨ÎûòÏãú Ï†úÍ±∞\n    const normalizedUrl = wsUrl.replace(/\\/$/, \"\");\n    console.log(\"WebSocket URL ÌôïÏù∏:\", normalizedUrl);\n    console.log(\"ÌôòÍ≤ΩÎ≥ÄÏàò REACT_APP_WS_URL:\", process.env.REACT_APP_WS_URL);\n    \n    return normalizedUrl;\n  }, []);\n\n  // WebSocket Ïó∞Í≤∞\n  const connect = useCallback(() => {\n    // Ïù¥ÎØ∏ Ïó∞Í≤∞ Ï§ëÏù¥Í±∞ÎÇò Ïó∞Í≤∞Îêú Í≤ΩÏö∞ Ï§ëÎ≥µ Ïó∞Í≤∞ Î∞©ÏßÄ\n    if (wsRef.current?.readyState === WebSocket.OPEN || \n        wsRef.current?.readyState === WebSocket.CONNECTING) {\n      console.log(\"Ïù¥ÎØ∏ Ïó∞Í≤∞Îêú WebSocketÏù¥ ÏûàÏäµÎãàÎã§ (readyState:\", wsRef.current.readyState, \")\");\n      return;\n    }\n\n    // Ïù¥Ï†Ñ Ïó∞Í≤∞Ïù¥ ÏûàÎã§Î©¥ Ï†ïÎ¶¨\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n\n    setIsConnecting(true);\n    setError(null);\n\n    try {\n      const wsUrl = getWebSocketUrl();\n      \n      if (!wsUrl) {\n        setError(\"Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ WebSocket URL\");\n        setIsConnecting(false);\n        return;\n      }\n\n      console.log(\"WebSocket Ïó∞Í≤∞ ÏãúÎèÑ:\", wsUrl);\n      console.log(\"Î∏åÎùºÏö∞Ï†Ä WebSocket ÏßÄÏõê:\", !!window.WebSocket);\n\n      // Ïó∞Í≤∞ ÏãúÎèÑ ÏãúÍ∞Ñ Í∏∞Î°ù\n      window.wsConnectStart = Date.now();\n\n      wsRef.current = new WebSocket(wsUrl);\n\n      // Ïó∞Í≤∞ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ\n      const connectionTimeout = setTimeout(() => {\n        if (wsRef.current?.readyState === WebSocket.CONNECTING) {\n          console.error(\"WebSocket Ïó∞Í≤∞ ÏãúÍ∞Ñ Ï¥àÍ≥º\");\n          wsRef.current.close();\n          setError(\"Ïó∞Í≤∞ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§\");\n          setIsConnecting(false);\n        }\n      }, 10000); // 10Ï¥à ÌÉÄÏûÑÏïÑÏõÉ\n\n      wsRef.current.onopen = (event) => {\n        clearTimeout(connectionTimeout);\n        console.log(\"üü¢ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ!\");\n        console.log(\"- Event:\", event);\n        console.log(\"- URL:\", wsRef.current?.url);\n        console.log(\"- Protocol:\", wsRef.current?.protocol);\n        console.log(\"- Extensions:\", wsRef.current?.extensions);\n        setIsConnected(true);\n        setIsConnecting(false);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n\n      wsRef.current.onclose = (event) => {\n        clearTimeout(connectionTimeout);\n        const connectionDuration = Date.now() - (window.wsConnectStart || 0);\n        \n        console.log(\"üî¥ WebSocket Ïó∞Í≤∞ Ï¢ÖÎ£å:\");\n        console.log(\"- Code:\", event.code);\n        console.log(\"- Reason:\", event.reason || \"(no reason provided)\");\n        console.log(\"- WasClean:\", event.wasClean);\n        console.log(\"- Connection duration:\", connectionDuration + \"ms\");\n        \n        setIsConnected(false);\n        setIsConnecting(false);\n\n        // Ï¶âÏãú Ï¢ÖÎ£åÎêú Í≤ΩÏö∞ (500ms Ïù¥ÎÇ¥) - ÏÑúÎ≤Ñ Î¨∏Ï†ú\n        if (connectionDuration < 500) {\n          console.error(\"‚ö†Ô∏è WebSocketÏù¥ Ï¶âÏãú Ï¢ÖÎ£åÎê® - ÏÑúÎ≤Ñ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±\");\n          \n          // ÌäπÏ†ï ÏóêÎü¨ ÏΩîÎìúÏóê Îî∞Î•∏ ÏÑ∏Î∂ÑÌôîÎêú ÏóêÎü¨ Î©îÏãúÏßÄ\n          let errorMessage = \"ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\";\n          switch(event.code) {\n            case 1006:\n              errorMessage = \"ÎπÑÏ†ïÏÉÅÏ†ÅÏù∏ Ïó∞Í≤∞ Ï¢ÖÎ£å (ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±)\";\n              break;\n            case 1002:\n              errorMessage = \"ÌîÑÎ°úÌÜ†ÏΩú Ïò§Î•ò\";\n              break;\n            case 1003:\n              errorMessage = \"ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ\";\n              break;\n            case 1011:\n              errorMessage = \"ÏÑúÎ≤Ñ ÎÇ¥Î∂Ä Ïò§Î•ò\";\n              break;\n          }\n          \n          setError(errorMessage);\n          return;\n        }\n\n        // ÏûêÎèô Ïû¨Ïó∞Í≤∞ (Ï†ïÏÉÅ Ï¢ÖÎ£åÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞)\n        if (\n          event.code !== 1000 &&\n          reconnectAttempts.current < maxReconnectAttempts\n        ) {\n          const delay = Math.min(\n            1000 * Math.pow(2, reconnectAttempts.current),\n            30000\n          );\n          console.log(\n            `üîÑ ${delay}ms ÌõÑ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ (${\n              reconnectAttempts.current + 1\n            }/${maxReconnectAttempts})`\n          );\n\n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttempts.current++;\n            connect();\n          }, delay);\n        } else if (reconnectAttempts.current >= maxReconnectAttempts) {\n          setError(\"ÏµúÎåÄ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ÌöüÏàòÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§.\");\n        }\n      };\n\n      wsRef.current.onerror = (error) => {\n        clearTimeout(connectionTimeout);\n        console.error(\"üí• WebSocket Ïò§Î•ò:\", error);\n        console.log(\"- ReadyState:\", wsRef.current?.readyState);\n        console.log(\"- URL:\", wsRef.current?.url);\n        setError(\"WebSocket Ïó∞Í≤∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§\");\n        setIsConnecting(false);\n      };\n\n    } catch (err) {\n      console.error(\"üí• WebSocket ÏÉùÏÑ± Ïã§Ìå®:\", err);\n      setError(\"WebSocket Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: \" + err.message);\n      setIsConnecting(false);\n    }\n  }, [getWebSocketUrl]);\n\n  // WebSocket Ïó∞Í≤∞ Ìï¥Ï†ú\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = null;\n    }\n\n    if (wsRef.current) {\n      wsRef.current.close(1000, \"Manual disconnect\");\n      wsRef.current = null;\n    }\n\n    setIsConnected(false);\n    setIsConnecting(false);\n    reconnectAttempts.current = 0;\n  }, []);\n\n  // Î©îÏãúÏßÄ Ï†ÑÏÜ°\n  const sendMessage = useCallback((message) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n      return true;\n    } else {\n      console.error(\"WebSocketÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§\");\n      setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");\n      return false;\n    }\n  }, []);\n\n  // Ïä§Ìä∏Î¶¨Î∞ç ÏöîÏ≤≠\n  const startStreaming = useCallback(\n    (userInput, chatHistory = []) => {\n      if (!isConnected) {\n        setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");\n        return false;\n      }\n\n      const message = {\n        action: \"stream\",\n        projectId,\n        userInput,\n        chat_history: chatHistory,\n      };\n\n      return sendMessage(message);\n    },\n    [isConnected, projectId, sendMessage]\n  );\n\n  // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Îì±Î°ù\n  const addMessageListener = useCallback((listener) => {\n    if (wsRef.current) {\n      wsRef.current.addEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Ï†úÍ±∞\n  const removeMessageListener = useCallback((listener) => {\n    if (wsRef.current) {\n      wsRef.current.removeEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏ Ïãú Ïó∞Í≤∞, Ïñ∏ÎßàÏö¥Ìä∏ Ïãú Ìï¥Ï†ú\n  useEffect(() => {\n    // Ï¥àÍ∏∞ Ïó∞Í≤∞ ÏßÄÏó∞ÏùÑ ÌÜµÌï¥ React strict mode Ïù¥Ïäà ÌöåÌîº\n    const timer = setTimeout(() => {\n      connect();\n    }, 100);\n    \n    return () => {\n      clearTimeout(timer);\n      disconnect();\n    };\n  }, []); // ÏùòÏ°¥ÏÑ± Î∞∞Ïó¥ÏùÑ Îπà Î∞∞Ïó¥Î°ú Î≥ÄÍ≤Ω\n\n  // projectId Î≥ÄÍ≤Ω Ïãú Ïû¨Ïó∞Í≤∞\n  useEffect(() => {\n    if (isConnected && projectId) {\n      console.log('ProjectId Î≥ÄÍ≤ΩÎê®, Ïû¨Ïó∞Í≤∞ Ï§ë:', projectId);\n      disconnect();\n      setTimeout(connect, 200);\n    }\n  }, [projectId]); // connect, disconnect ÏùòÏ°¥ÏÑ± Ï†úÍ±∞\n\n  return {\n    isConnected,\n    isConnecting,\n    error,\n    connect,\n    disconnect,\n    sendMessage,\n    startStreaming,\n    addMessageListener,\n    removeMessageListener,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}